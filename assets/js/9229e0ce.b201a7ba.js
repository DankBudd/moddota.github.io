"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[2494],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>p});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=c(n),p=i,h=d["".concat(s,".").concat(p)]||d[p]||u[p]||a;return n?r.createElement(h,o(o({ref:t},m),{},{components:n})):r.createElement(h,o({ref:t},m))}));function p(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var c=2;c<a;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3919:(e,t,n)=>{function r(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!r(e)}n.d(t,{b:()=>r,Z:()=>i})},4996:(e,t,n)=>{n.d(t,{C:()=>a,Z:()=>o});var r=n(2263),i=n(3919);function a(){const{siteConfig:{baseUrl:e="/",url:t}={}}=(0,r.Z)();return{withBaseUrl:(n,r)=>function(e,t,n,{forcePrependBaseUrl:r=!1,absolute:a=!1}={}){if(!n)return n;if(n.startsWith("#"))return n;if((0,i.b)(n))return n;if(r)return t+n;const o=n.startsWith(t)?n:t+n.replace(/^\//,"");return a?e+o:o}(t,e,n,r)}}function o(e,t={}){const{withBaseUrl:n}=a();return n(e,t)}},8215:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(7294);const i=function({children:e,hidden:t,className:n}){return r.createElement("div",{role:"tabpanel",hidden:t,className:n},e)}},1395:(e,t,n)=>{n.d(t,{Z:()=>m});var r=n(7294),i=n(944),a=n(6010);const o="tabItem_1uMI",l="tabItemActive_2DSg";const s=37,c=39;const m=function(e){const{lazy:t,block:n,defaultValue:m,values:u,groupId:d,className:p}=e,{tabGroupChoices:h,setTabGroupChoices:f}=(0,i.Z)(),[b,g]=(0,r.useState)(m),v=r.Children.toArray(e.children),y=[];if(null!=d){const e=h[d];null!=e&&e!==b&&u.some((t=>t.value===e))&&g(e)}const k=e=>{const t=e.currentTarget,n=y.indexOf(t),r=u[n].value;g(r),null!=d&&(f(d,r),setTimeout((()=>{(function(e){const{top:t,left:n,bottom:r,right:i}=e.getBoundingClientRect(),{innerHeight:a,innerWidth:o}=window;return t>=0&&i<=o&&r<=a&&n>=0})(t)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(l),setTimeout((()=>t.classList.remove(l)),2e3))}),150))},w=e=>{var t;let n;switch(e.keyCode){case c:{const t=y.indexOf(e.target)+1;n=y[t]||y[0];break}case s:{const t=y.indexOf(e.target)-1;n=y[t]||y[y.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":n},p)},u.map((({value:e,label:t})=>r.createElement("li",{role:"tab",tabIndex:b===e?0:-1,"aria-selected":b===e,className:(0,a.Z)("tabs__item",o,{"tabs__item--active":b===e}),key:e,ref:e=>y.push(e),onKeyDown:w,onFocus:k,onClick:k},t)))),t?(0,r.cloneElement)(v.filter((e=>e.props.value===b))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},v.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==b})))))}},9443:(e,t,n)=>{n.d(t,{Z:()=>r});const r=(0,n(7294).createContext)(void 0)},944:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(7294),i=n(9443);const a=function(){const e=(0,r.useContext)(i.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},7840:(e,t,n)=>{n.d(t,{s:()=>i});var r=n(7294);function i({id:e,aspectRatio:t=4/3,hd:n="0"}){return r.createElement("p",{style:{position:"relative",paddingBottom:1/t*100+"%"}},r.createElement("iframe",{src:`https://gfycat.com/ifr/${e}?hd=${n}`,scrolling:"no",frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},8173:(e,t,n)=>{n.d(t,{s:()=>s});var r=n(2177),i=n(8215),a=n(1395),o=n(7294);const l={lua:"Lua",ts:"TypeScript",tsx:"TypeScript",js:"JavaScript",jsx:"JavaScript"};function s({children:e,group:t,titles:n}){(0,r.Z)("string"==typeof t||void 0===t);const s=o.Children.toArray(e).map(((e,t)=>{var r;const i=(null==(r=e.props.children.props.className)?void 0:r.replace(/language-/,""))??`Tab ${t+1}`;return{id:t,languageName:(void 0!==n&&n.length>0?n.split("|"):[])[t]??l[i]??i,element:e}}));return o.createElement(a.Z,{groupId:void 0!==t?`multi-code-block-${t}`:void 0,defaultValue:s[0].id,values:s.map((({id:e,languageName:t})=>({value:e,label:t})))},s.map((({id:e,element:t})=>o.createElement(i.Z,{key:e,value:e},t))))}},6776:(e,t,n)=>{n.d(t,{X:()=>a});var r=n(4996),i=n(7294);function a({path:e,controls:t=!1}){return i.createElement("video",{width:"100%",height:"100%",autoPlay:!0,muted:!0,loop:!0,controls:t},i.createElement("source",{src:(0,r.Z)(e),type:"video/mp4"}))}},8129:(e,t,n)=>{n.d(t,{_:()=>i});var r=n(7294);function i({id:e,playlistId:t,aspectRatio:n=16/9}){const i=void 0!==t?`https://www.youtube.com/embed/videoseries?list=${t}`:`https://www.youtube.com/embed/${e}`;return r.createElement("p",{style:{position:"relative",paddingBottom:1/n*100+"%"}},r.createElement("iframe",{src:i,frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},9753:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>o,metadata:()=>l,toc:()=>s,default:()=>m});var r=n(7462),i=(n(7294),n(3905)),a=(n(1395),n(8215),n(7840));n(8129),n(8173),n(6776);const o={title:"Item Restrictions & Requirements",author:"Noya",steamId:"76561198046984233",date:"13.12.2014"},l={unversionedId:"scripting/item-restrictions-requirements",id:"scripting/item-restrictions-requirements",isDocsHomePage:!1,title:"Item Restrictions & Requirements",description:"This implements the following mechanic:",source:"@site/_articles/scripting/item-restrictions-requirements.md",sourceDirName:"scripting",slug:"/scripting/item-restrictions-requirements",permalink:"/scripting/item-restrictions-requirements",editUrl:"https://github.com/ModDota/moddota.github.io/edit/source/_articles/scripting/item-restrictions-requirements.md",version:"current",frontMatter:{title:"Item Restrictions & Requirements",author:"Noya",steamId:"76561198046984233",date:"13.12.2014"},sidebar:"tutorials",previous:{title:"Custom Mana System",permalink:"/scripting/custom-mana-system"},next:{title:"Item Drop System",permalink:"/scripting/item-drop-system"}},s=[{value:"1. Key Values Table",id:"1-key-values-table",children:[]},{value:"2. OnEquip Ability Event",id:"2-onequip-ability-event",children:[]},{value:"3. Lua Script",id:"3-lua-script",children:[]}],c={toc:s};function m({components:e,...t}){return(0,i.kt)("wrapper",(0,r.Z)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This implements the following mechanic:"),(0,i.kt)(a.s,{id:"OfficialAdorableJabiru",mdxType:"Gfycat"}),(0,i.kt)("h3",{id:"1-key-values-table"},"1. Key Values Table"),(0,i.kt)("p",null,"First create a text file to write down your item properties. File Name, extension and path can be anything as long as the file structure is a proper table."),(0,i.kt)("p",null,"For this example, we will use this path: ",(0,i.kt)("strong",{parentName:"p"},"scripts"),"/",(0,i.kt)("strong",{parentName:"p"},"maps"),"/",(0,i.kt)("strong",{parentName:"p"},"item_info"),".kv"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'"Items"\n{\n    "item_name_here" //change it to a custom items\n    {\n        "levelRequired" "10"\n        "classRequired" "Warrior" \n    }\n\n    "item_other_name_here" \n    {\n        "levelRequired" "25"\n    }\n}\n')),(0,i.kt)("p",null,'To load a table into your game mode, you need to use the `LoadKeyValues( "path/to/file" ) lua function. This can be called at GameMode:InitGameMode() inside your main lua addon. GameMode = self'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'self.ItemInfoKV = LoadKeyValues( "scripts/maps/item_info.kv" ) \n')),(0,i.kt)("p",null,"If your table is badly formed (e.g. you missed a quotation mark or a bracket), this will fail and you'll get a lua console error when starting the game."),(0,i.kt)("p",null,'Note how I didn\'t add a "classRequired" to the 2nd item. When trying to access the ',(0,i.kt)("inlineCode",{parentName:"p"},"GameMode.ItemInfoKV[itemNane].classRequired")," value will be nil, meaning there is no restriction on class (but still checks the level)"),(0,i.kt)("p",null,"There are many ways to set a class, the most basic one is indexing ",(0,i.kt)("inlineCode",{parentName:"p"},".class")," in the hero handle the first time the hero is in game (using the barebones.lua default calls)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'function GameMode:OnHeroInGame(hero)\n\n    if heroName == "npc_dota_hero_axe" then\n        hero.class = "Warrior"\n        print("Axe is ready!")\n    end\n    \nend\n')),(0,i.kt)("h3",{id:"2-onequip-ability-event"},"2. OnEquip Ability Event"),(0,i.kt)("p",null,"Add this datadriven event on every item that needs to do a check for restrictions. It calls a lua script to do the logic check against the table."),(0,i.kt)("p",null,"This is needed because the listener for inventory changed is broken, and the Lua ",(0,i.kt)("inlineCode",{parentName:"p"},"OnItemPickedUp")," event hook doesn't account for someone dragging an item into another players inventory."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'"OnEquip" \n{   \n    "RunScript"\n    {\n        "ScriptFile"    "items.lua"\n        "Function"  "ItemCheck"\n    }\n}\n')),(0,i.kt)("h3",{id:"3-lua-script"},"3. Lua Script"),(0,i.kt)("p",null,"In this example, I'll look for Level and Class requirements"),(0,i.kt)("p",null,"Make use of the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/zedor/CustomError"},"CustomError Flash UI by zedor")," to display a red error message when the item doesn't met any criteria found in the table."),(0,i.kt)("p",null,"There are some ",(0,i.kt)("inlineCode",{parentName:"p"},"DeepPrintTable")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"print")," to check that the table is being reviewed as you expect."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'function ItemCheck( event )\n    local itemName = event.ability:GetAbilityName()\n    local hero = EntIndexToHScript( event.caster_entindex )\n    local itemTable = GameMode.ItemInfoKV[itemName]\n    print("Checking Restrictions for "..itemName)\n    DeepPrintTable(itemTable)\n\n    -- if there is no subtable for this item, end this script\n    if itemTable == nil then\n        return true\n    end\n\n    -- This timer is needed because OnEquip triggers before the item actually being in inventory\n    Timers:CreateTimer(0.1,function()\n        -- Go through every item slot\n        for itemSlot = 0, 5, 1 do \n            local Item = hero:GetItemInSlot( itemSlot )\n            -- When we find the item we want to check\n            if Item ~= nil and itemName == Item:GetName() then\n                DeepPrintTable(Item)\n\n                -- Check Level Restriction\n                if itemTable.levelRequired then\n                    print("Name","Level Req","Hero Level")\n                    print(itemName,itemTable.levelRequired,hero:GetLevel())\n                    -- If the hero doesn\'t met the level required, show message and call DropItem\n                    if itemTable.levelRequired > hero:GetLevel() then\n                        FireGameEvent( \'custom_error_show\', { player_ID = pID, _error = "You need level "..itemTable.levelRequired.." to use this." } )\n                        DropItem(Item, hero)\n                    end \n                end\n\n                -- Check Class Restriction\n                if itemTable.classRequired then\n                    print("Name","Class Req","Hero Class")\n                    print(itemName,itemTable.classRequired,hero.class)\n                    -- If the item is for an specific class, message and drop\n                    if itemTable.classRequired ~= hero.class then\n                        FireGameEvent( \'custom_error_show\', { player_ID = pID, _error = "Requires ".. hero.class .." to use." } )\n                        DropItem(Item, hero)\n                    end\n                end\n            end\n        end\n    end)\nend\n\nfunction DropItem( item, hero )\n    -- Error Sound\n    EmitSoundOnClient("General.CastFail_InvalidTarget_Hero", hero:GetPlayerOwner())\n\n    -- Create a new empty item\n    local newItem = CreateItem( item:GetName(), nil, nil )\n    newItem:SetPurchaseTime( 0 )\n\n    -- This is needed if you are working with items with charges, uncomment it if so.\n    -- newItem:SetCurrentCharges( goldToDrop )\n\n    -- Make a new item and launch it near the hero\n    local spawnPoint = Vector( 0, 0, 0 )\n    spawnPoint = hero:GetAbsOrigin()\n    local drop = CreateItemOnPositionSync( spawnPoint, newItem )\n    newItem:LaunchLoot( false, 200, 0.75, spawnPoint + RandomVector( RandomFloat( 50, 150 ) ) )\n    \n    --finally, remove the item\n    hero:RemoveItem(item)\nend\n\n')),(0,i.kt)("hr",null),(0,i.kt)("p",null,"Leave your questions or suggestions below."))}m.isMDXComponent=!0},6010:(e,t,n)=>{function r(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=r(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}function i(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=r(e))&&(i&&(i+=" "),i+=t);return i}n.d(t,{Z:()=>i})}}]);