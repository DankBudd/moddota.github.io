"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[1757],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=i,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3919:(e,t,n)=>{function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!a(e)}n.d(t,{b:()=>a,Z:()=>i})},4996:(e,t,n)=>{n.d(t,{C:()=>o,Z:()=>r});var a=n(2263),i=n(3919);function o(){const{siteConfig:{baseUrl:e="/",url:t}={}}=(0,a.Z)();return{withBaseUrl:(n,a)=>function(e,t,n,{forcePrependBaseUrl:a=!1,absolute:o=!1}={}){if(!n)return n;if(n.startsWith("#"))return n;if((0,i.b)(n))return n;if(a)return t+n;const r=n.startsWith(t)?n:t+n.replace(/^\//,"");return o?e+r:r}(t,e,n,a)}}function r(e,t={}){const{withBaseUrl:n}=o();return n(e,t)}},8215:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294);const i=function({children:e,hidden:t,className:n}){return a.createElement("div",{role:"tabpanel",hidden:t,className:n},e)}},1395:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(7294),i=n(944),o=n(6010);const r="tabItem_1uMI",l="tabItemActive_2DSg";const s=37,p=39;const c=function(e){const{lazy:t,block:n,defaultValue:c,values:u,groupId:d,className:m}=e,{tabGroupChoices:h,setTabGroupChoices:y}=(0,i.Z)(),[g,f]=(0,a.useState)(c),k=a.Children.toArray(e.children),v=[];if(null!=d){const e=h[d];null!=e&&e!==g&&u.some((t=>t.value===e))&&f(e)}const w=e=>{const t=e.currentTarget,n=v.indexOf(t),a=u[n].value;f(a),null!=d&&(y(d,a),setTimeout((()=>{(function(e){const{top:t,left:n,bottom:a,right:i}=e.getBoundingClientRect(),{innerHeight:o,innerWidth:r}=window;return t>=0&&i<=r&&a<=o&&n>=0})(t)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(l),setTimeout((()=>t.classList.remove(l)),2e3))}),150))},b=e=>{var t;let n;switch(e.keyCode){case p:{const t=v.indexOf(e.target)+1;n=v[t]||v[0];break}case s:{const t=v.indexOf(e.target)-1;n=v[t]||v[v.length-1];break}}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},m)},u.map((({value:e,label:t})=>a.createElement("li",{role:"tab",tabIndex:g===e?0:-1,"aria-selected":g===e,className:(0,o.Z)("tabs__item",r,{"tabs__item--active":g===e}),key:e,ref:e=>v.push(e),onKeyDown:b,onFocus:w,onClick:w},t)))),t?(0,a.cloneElement)(k.filter((e=>e.props.value===g))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},k.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==g})))))}},9443:(e,t,n)=>{n.d(t,{Z:()=>a});const a=(0,n(7294).createContext)(void 0)},944:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294),i=n(9443);const o=function(){const e=(0,a.useContext)(i.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},7840:(e,t,n)=>{n.d(t,{s:()=>i});var a=n(7294);function i({id:e,aspectRatio:t=4/3,hd:n="0"}){return a.createElement("p",{style:{position:"relative",paddingBottom:1/t*100+"%"}},a.createElement("iframe",{src:`https://gfycat.com/ifr/${e}?hd=${n}`,scrolling:"no",frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},8173:(e,t,n)=>{n.d(t,{s:()=>s});var a=n(2177),i=n(8215),o=n(1395),r=n(7294);const l={lua:"Lua",ts:"TypeScript",tsx:"TypeScript",js:"JavaScript",jsx:"JavaScript"};function s({children:e,group:t,titles:n}){(0,a.Z)("string"==typeof t||void 0===t);const s=r.Children.toArray(e).map(((e,t)=>{var a;const i=(null==(a=e.props.children.props.className)?void 0:a.replace(/language-/,""))??`Tab ${t+1}`;return{id:t,languageName:(void 0!==n&&n.length>0?n.split("|"):[])[t]??l[i]??i,element:e}}));return r.createElement(o.Z,{groupId:void 0!==t?`multi-code-block-${t}`:void 0,defaultValue:s[0].id,values:s.map((({id:e,languageName:t})=>({value:e,label:t})))},s.map((({id:e,element:t})=>r.createElement(i.Z,{key:e,value:e},t))))}},6776:(e,t,n)=>{n.d(t,{X:()=>o});var a=n(4996),i=n(7294);function o({path:e,controls:t=!1}){return i.createElement("video",{width:"100%",height:"100%",autoPlay:!0,muted:!0,loop:!0,controls:t},i.createElement("source",{src:(0,a.Z)(e),type:"video/mp4"}))}},8129:(e,t,n)=>{n.d(t,{_:()=>i});var a=n(7294);function i({id:e,playlistId:t,aspectRatio:n=16/9}){const i=void 0!==t?`https://www.youtube.com/embed/videoseries?list=${t}`:`https://www.youtube.com/embed/${e}`;return a.createElement("p",{style:{position:"relative",paddingBottom:1/n*100+"%"}},a.createElement("iframe",{src:i,frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},3658:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>r,metadata:()=>l,toc:()=>s,default:()=>c});var a=n(7462),i=(n(7294),n(3905)),o=(n(1395),n(8215),n(7840));n(8129),n(8173),n(6776);const r={title:"DOTAScenePanel",author:"DoctorGester",steamId:"76561198046920629",date:"02.04.2016"},l={unversionedId:"panorama/dotascenepanel",id:"panorama/dotascenepanel",isDocsHomePage:!1,title:"DOTAScenePanel",description:"In this tutorial we'll go through the tricks you can do with the undocumented DOTAScenePanel class in panorama.",source:"@site/_articles/panorama/dotascenepanel.md",sourceDirName:"panorama",slug:"/panorama/dotascenepanel",permalink:"/panorama/dotascenepanel",editUrl:"https://github.com/ModDota/moddota.github.io/edit/source/_articles/panorama/dotascenepanel.md",version:"current",frontMatter:{title:"DOTAScenePanel",author:"DoctorGester",steamId:"76561198046920629",date:"02.04.2016"},sidebar:"tutorials",previous:{title:"Keybindings",permalink:"/panorama/keybindings"},next:{title:"Button Examples",permalink:"/panorama/button-examples"}},s=[{value:"Background maps",id:"background-maps",children:[{value:"Setting up the map",id:"setting-up-the-map",children:[]},{value:"Setting up panorama",id:"setting-up-panorama",children:[]}]},{value:"The part where magic gets real",id:"the-part-where-magic-gets-real",children:[{value:"Units with cosmetics",id:"units-with-cosmetics",children:[]},{value:"Multiple cameras",id:"multiple-cameras",children:[]},{value:"Dynamic layout loading",id:"dynamic-layout-loading",children:[]},{value:"Firing IO events",id:"firing-io-events",children:[]}]}],p={toc:s};function c({components:e,...t}){return(0,i.kt)("wrapper",(0,a.Z)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"In this tutorial we'll go through the tricks you can do with the undocumented DOTAScenePanel class in panorama."),(0,i.kt)("p",null,"Now, you might have seen its usage if you looked through the sources in the main menu. This panel allows us to display 3D content in panorama. You might have tried using it yourself. It's pretty easy to setup a simple panel to display a unit, with code like"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},'<DOTAScenePanel style="width:400px;height:400px;" unit="npc_dota_hero_sven" particleonly="false"/>')),(0,i.kt)("p",null,"Please note ",(0,i.kt)("inlineCode",{parentName:"p"},"particleonly='false'")," is required for ",(0,i.kt)("inlineCode",{parentName:"p"},"DOTAScenePanel")," to display anything other then particles properly."),(0,i.kt)("p",null,"Code like this is used to display heroes in the armory. This panel is also has no custom dynamic properties, meaning that we can't change the unit after creating a panel."),(0,i.kt)("p",null,"In armory, heroes models can be rotated, and this behaviour can be enabled with ",(0,i.kt)("inlineCode",{parentName:"p"},'allowrotation="true"')," settled. However, this parameter is not compatible with custom background maps."),(0,i.kt)("h2",{id:"background-maps"},"Background maps"),(0,i.kt)("p",null,"But wait, there's more! DOTAScenePanel accepts the \"map\" parameter, which points to a specific type of vmaps - background maps. You can find them in asset browser in background folder. Those vmaps only accept a specific set of entities and are shown in panorama using cameras. Let's follow up by creating a simple background map."),(0,i.kt)("h3",{id:"setting-up-the-map"},"Setting up the map"),(0,i.kt)("p",null,"Start up hammer editor and create a new map. Save it in your maps folder as 'background.vmap'. Go to Map -> Map Properties (Ctrl-Shift-P) and check the 'Compile as background map' checkbox."),(0,i.kt)("p",null,"Use the Entity Tool (Shift-E) and choose the ",(0,i.kt)("inlineCode",{parentName:"p"},"prop_dynamic")," entity, then click somewhere in the world to place it."),(0,i.kt)("p",null,"Select that newly placed entity in the outliner and change its ",(0,i.kt)("inlineCode",{parentName:"p"},"World Model")," property to ",(0,i.kt)("inlineCode",{parentName:"p"},"models/courier/donkey_unicorn/donkey_unicorn.vmdl"),"."),(0,i.kt)("p",null,"Now you've got your movie star ready to be displayed. You can also change the ",(0,i.kt)("inlineCode",{parentName:"p"},"Default Animation")," field to ",(0,i.kt)("inlineCode",{parentName:"p"},"idle")," or any string from its model entries."),(0,i.kt)("p",null,"Now we've got ",(0,i.kt)("em",{parentName:"p"},"action"),", but still missing ",(0,i.kt)("em",{parentName:"p"},"lights")," and ",(0,i.kt)("em",{parentName:"p"},"camera"),". Let's begin with light - with the Entity Tool (Shift-E), create a ",(0,i.kt)("inlineCode",{parentName:"p"},"env_global_light")," entity. Change it's name to ",(0,i.kt)("inlineCode",{parentName:"p"},"light"),", for example."),(0,i.kt)("p",null,"Same as ",(0,i.kt)("inlineCode",{parentName:"p"},"env_global_light"),", create a ",(0,i.kt)("inlineCode",{parentName:"p"},"point_camera")," entity.\nSelect your newly created camera, move your hammer camera in such way that you can see the donkey and click ",(0,i.kt)("inlineCode",{parentName:"p"},"View - Align Selection to Active Camera"),"."),(0,i.kt)("p",null,"As the last step select your camera and give it a name in the properties, like ",(0,i.kt)("inlineCode",{parentName:"p"},"camera1"),"."),(0,i.kt)("p",null,"Save your map and build it (F9)."),(0,i.kt)("h3",{id:"setting-up-panorama"},"Setting up panorama"),(0,i.kt)("p",null,"I won't describe how to set up a basic panorama environment, if you are having issues with displaying simple panels, refer to ",(0,i.kt)("a",{parentName:"p",href:"https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama"},"https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama")," Once you've ready to go, simply add ",(0,i.kt)("inlineCode",{parentName:"p"},'<DOTAScenePanel style="width:400px;height:400px;" map="background" light="light" camera="camera1" particleonly="false"/>')," to your XML, you should see your donkey movie star in its full glory. Shouldn't take you more than 10 minutes."),(0,i.kt)(o.s,{id:"BlackSameAoudad",mdxType:"Gfycat"}),(0,i.kt)("p",null,"Now let's get to the advanced part."),(0,i.kt)("h2",{id:"the-part-where-magic-gets-real"},"The part where magic gets real"),(0,i.kt)("h3",{id:"units-with-cosmetics"},"Units with cosmetics"),(0,i.kt)("p",null,'We can easily build up a "unit" like scene, using the ',(0,i.kt)("inlineCode",{parentName:"p"},"portrait_world_unit")," entity type. This entity supports all kinds of units and also cosmetic item definitions. The quirk here is that you have to enter the raw properties editing mode to set displayed entity to a hero. Item definitions property all refer to different loadout slots and accept item IDs. Item ID list can be found ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/dotabuff/d2vpk/blob/master/dota_pak01/scripts/items/items_game.txt"},"here"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://i.imgur.com/ZsmLQA3.png",alt:"Lina is awesome",title:"Example"})),(0,i.kt)("h3",{id:"multiple-cameras"},"Multiple cameras"),(0,i.kt)("p",null,"This is pretty straightforward, ",(0,i.kt)("inlineCode",{parentName:"p"},"DOTAScenePanel")," also accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"camera")," parameter in the definition, which will try to find the camera with the provided name."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://puu.sh/o3Gv7/783de89488.jpg",alt:"https://puu.sh/o3Gv7/783de89488.jpg"})),(0,i.kt)("p",null,"Important to note, compiling the map again does change the look of the panorama panel without restarting the map, but you can't change it at runtime. You'll understand how to achieve the same result in the following parts."),(0,i.kt)("h3",{id:"dynamic-layout-loading"},"Dynamic layout loading"),(0,i.kt)("p",null,"Since the only thing DOTAScenePanel respects is its own layout definition, we will have to provide it from the start. Fortunately we can load layout from string, while altering the definition."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'var camera = "camera1";\nvar style = "width:400px;height:400px;";\nif (someCondition) {\n    camera = "camera2";\n}\n\nvar sceneContainer = $("#SomeContainer");\nsceneContainer.BCreateChildren("<DOTAScenePanel style=\'" + style + "\' map=\'background\' particleonly=\'false\' light=\'light\' camera=\'" + camera + "\'"/>");\n')),(0,i.kt)("p",null,"As you might have noticed, you have to wrap the whole thing in '', while also providing the initial container for the layout. Pretty terrible, but for now it seems like the only way."),(0,i.kt)("h3",{id:"firing-io-events"},"Firing IO events"),(0,i.kt)("h4",{id:"animation"},"Animation"),(0,i.kt)("p",null,"Now the REAL fun starts. Dashboard source code uses the ",(0,i.kt)("inlineCode",{parentName:"p"},"DOTAGlobalSceneFireEntityInput")," event which starts the particles on the home button, for example. This event is basically a ",(0,i.kt)("inlineCode",{parentName:"p"},"DoEntFire")," specifically for DOTAScenePanel."),(0,i.kt)("p",null,"For example usage, set up a simple ",(0,i.kt)("inlineCode",{parentName:"p"},'<DOTAScenePanel id="scene" style="width:400px;height:400px;" map="background"/>')," (notice the ",(0,i.kt)("inlineCode",{parentName:"p"},"id"),", it's very important!) once again. But this time, alter the map and change the donkey ",(0,i.kt)("inlineCode",{parentName:"p"},"Name")," property to ",(0,i.kt)("inlineCode",{parentName:"p"},"donkey"),", don't forget to rebuild the map."),(0,i.kt)("p",null,"Now make a basic panorama button, and give it ",(0,i.kt)("inlineCode",{parentName:"p"},'onactivate="DOTAGlobalSceneFireEntityInput(scene, donkey, SetAnimation, death)"'),"."),(0,i.kt)("p",null,"Now if you've done everything correctly, your donkey should play his death animation every time you press the button. How? Magic. But really though, refer to the ",(0,i.kt)("em",{parentName:"p"},"Inputs")," part of ",(0,i.kt)("a",{parentName:"p",href:"https://developer.valvesoftware.com/wiki/Prop_dynamic"},"this page"),". Notice the ",(0,i.kt)("inlineCode",{parentName:"p"},"SetAnimation")," input."),(0,i.kt)("p",null,"Also notice how we've used ",(0,i.kt)("inlineCode",{parentName:"p"},"DOTAGlobalSceneFireEntityInput")," in onactivate as if it were a real function, which it isn't. That's because panel events are special cornflakes. In panorama javascript you have to use ",(0,i.kt)("inlineCode",{parentName:"p"},'$.DispatchEvent("DOTAGlobalSceneFireEntityInput", arguments)')," to achieve the same result."),(0,i.kt)("p",null,"Example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'$.DispatchEvent("DOTAGlobalSceneFireEntityInput", "LightBuilder", "donkey", "SetAnimation", "spawn");\n')),(0,i.kt)("h4",{id:"scripts-scripts"},"Scripts? Scripts!"),(0,i.kt)("p",null,"If you were a good boy, you might have noticed the ",(0,i.kt)("inlineCode",{parentName:"p"},"RunScriptFile")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"RunScriptCode")," inputs."),(0,i.kt)("p",null,"Now make a ",(0,i.kt)("inlineCode",{parentName:"p"},"donkey.lua")," file in your ",(0,i.kt)("inlineCode",{parentName:"p"},"vscripts")," folder and put a simple ",(0,i.kt)("inlineCode",{parentName:"p"},'print("Onions have layers, donkey")')," in it."),(0,i.kt)("p",null,"Now set your button onactivate to ",(0,i.kt)("inlineCode",{parentName:"p"},"DOTAGlobalSceneFireEntityInput(scene, donkey, RunScriptFile, donkey)"),"."),(0,i.kt)("p",null,"Notice the lack of file extension. Press the button again. You should see the message in the console. Congratulations!"),(0,i.kt)("p",null,"But don't get too excited. Yes, you can execute lua from panorama. But it's ",(0,i.kt)("em",{parentName:"p"},"clientside"),"-lua and it's ",(0,i.kt)("em",{parentName:"p"},"very")," limited. You can't even move things there. The only good thing I could think to do is particles. A recent patch added ParticleManager support to clientside lua. So theoretically you can create, destroy and move different particles there, and particles are very powerful."),(0,i.kt)("h4",{id:"entity-parenting"},"Entity parenting"),(0,i.kt)("p",null,"The way cosmetics in dota works is that every cosmetic item is a separate entity which is parented to a hero, attached to a specific attach point with specific offsets and offset angles. And we can do that too! (Well, partly, at least)"),(0,i.kt)("p",null,"The way that works is you select a prop_dynamic, in object properties put up a parent entity name, put in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Parent Model Bone/Attachment Name")," (you can look up attachment names in the model editor), check the ",(0,i.kt)("inlineCode",{parentName:"p"},"Use Model Attachment Offset")," checkbox and then realize that changing attachment offset doesn't work. At least for now. Changing angles works though so there is hope that offset will be fixed someday."),(0,i.kt)("p",null,"That's it for today!"))}c.isMDXComponent=!0},6010:(e,t,n)=>{function a(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}function i(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(i&&(i+=" "),i+=t);return i}n.d(t,{Z:()=>i})}}]);