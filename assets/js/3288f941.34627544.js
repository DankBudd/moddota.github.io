"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[3944],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,f=p["".concat(l,".").concat(m)]||p[m]||d[m]||r;return n?o.createElement(f,i(i({ref:t},c),{},{components:n})):o.createElement(f,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<r;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3919:(e,t,n)=>{function o(e){return!0===/^(\w*:|\/\/)/.test(e)}function a(e){return void 0!==e&&!o(e)}n.d(t,{b:()=>o,Z:()=>a})},4996:(e,t,n)=>{n.d(t,{C:()=>r,Z:()=>i});var o=n(2263),a=n(3919);function r(){const{siteConfig:{baseUrl:e="/",url:t}={}}=(0,o.Z)();return{withBaseUrl:(n,o)=>function(e,t,n,{forcePrependBaseUrl:o=!1,absolute:r=!1}={}){if(!n)return n;if(n.startsWith("#"))return n;if((0,a.b)(n))return n;if(o)return t+n;const i=n.startsWith(t)?n:t+n.replace(/^\//,"");return r?e+i:i}(t,e,n,o)}}function i(e,t={}){const{withBaseUrl:n}=r();return n(e,t)}},8215:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(7294);const a=function({children:e,hidden:t,className:n}){return o.createElement("div",{role:"tabpanel",hidden:t,className:n},e)}},1395:(e,t,n)=>{n.d(t,{Z:()=>c});var o=n(7294),a=n(944),r=n(6010);const i="tabItem_1uMI",s="tabItemActive_2DSg";const l=37,u=39;const c=function(e){const{lazy:t,block:n,defaultValue:c,values:d,groupId:p,className:m}=e,{tabGroupChoices:f,setTabGroupChoices:h}=(0,a.Z)(),[b,y]=(0,o.useState)(c),g=o.Children.toArray(e.children),v=[];if(null!=p){const e=f[p];null!=e&&e!==b&&d.some((t=>t.value===e))&&y(e)}const w=e=>{const t=e.currentTarget,n=v.indexOf(t),o=d[n].value;y(o),null!=p&&(h(p,o),setTimeout((()=>{(function(e){const{top:t,left:n,bottom:o,right:a}=e.getBoundingClientRect(),{innerHeight:r,innerWidth:i}=window;return t>=0&&a<=i&&o<=r&&n>=0})(t)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(s),setTimeout((()=>t.classList.remove(s)),2e3))}),150))},k=e=>{var t;let n;switch(e.keyCode){case u:{const t=v.indexOf(e.target)+1;n=v[t]||v[0];break}case l:{const t=v.indexOf(e.target)-1;n=v[t]||v[v.length-1];break}}null==(t=n)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},m)},d.map((({value:e,label:t})=>o.createElement("li",{role:"tab",tabIndex:b===e?0:-1,"aria-selected":b===e,className:(0,r.Z)("tabs__item",i,{"tabs__item--active":b===e}),key:e,ref:e=>v.push(e),onKeyDown:k,onFocus:w,onClick:w},t)))),t?(0,o.cloneElement)(g.filter((e=>e.props.value===b))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},g.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==b})))))}},9443:(e,t,n)=>{n.d(t,{Z:()=>o});const o=(0,n(7294).createContext)(void 0)},944:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(7294),a=n(9443);const r=function(){const e=(0,o.useContext)(a.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},7840:(e,t,n)=>{n.d(t,{s:()=>a});var o=n(7294);function a({id:e,aspectRatio:t=4/3,hd:n="0"}){return o.createElement("p",{style:{position:"relative",paddingBottom:1/t*100+"%"}},o.createElement("iframe",{src:`https://gfycat.com/ifr/${e}?hd=${n}`,scrolling:"no",frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},8173:(e,t,n)=>{n.d(t,{s:()=>l});var o=n(2177),a=n(8215),r=n(1395),i=n(7294);const s={lua:"Lua",ts:"TypeScript",tsx:"TypeScript",js:"JavaScript",jsx:"JavaScript"};function l({children:e,group:t,titles:n}){(0,o.Z)("string"==typeof t||void 0===t);const l=i.Children.toArray(e).map(((e,t)=>{var o;const a=(null==(o=e.props.children.props.className)?void 0:o.replace(/language-/,""))??`Tab ${t+1}`;return{id:t,languageName:(void 0!==n&&n.length>0?n.split("|"):[])[t]??s[a]??a,element:e}}));return i.createElement(r.Z,{groupId:void 0!==t?`multi-code-block-${t}`:void 0,defaultValue:l[0].id,values:l.map((({id:e,languageName:t})=>({value:e,label:t})))},l.map((({id:e,element:t})=>i.createElement(a.Z,{key:e,value:e},t))))}},6776:(e,t,n)=>{n.d(t,{X:()=>r});var o=n(4996),a=n(7294);function r({path:e,controls:t=!1}){return a.createElement("video",{width:"100%",height:"100%",autoPlay:!0,muted:!0,loop:!0,controls:t},a.createElement("source",{src:(0,o.Z)(e),type:"video/mp4"}))}},8129:(e,t,n)=>{n.d(t,{_:()=>a});var o=n(7294);function a({id:e,playlistId:t,aspectRatio:n=16/9}){const a=void 0!==t?`https://www.youtube.com/embed/videoseries?list=${t}`:`https://www.youtube.com/embed/${e}`;return o.createElement("p",{style:{position:"relative",paddingBottom:1/n*100+"%"}},o.createElement("iframe",{src:a,frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},3853:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>r,metadata:()=>i,toc:()=>s,default:()=>u});var o=n(7462),a=(n(7294),n(3905));n(1395),n(8215),n(7840),n(8129),n(8173),n(6776);const r={title:"Extending Hero/NPC API with lua modifiers",author:"DrTeaSpoon",steamId:"76561197975484185",date:"21.08.2016"},i={unversionedId:"abilities/lua-modifiers/1",id:"abilities/lua-modifiers/1",isDocsHomePage:!1,title:"Extending Hero/NPC API with lua modifiers",description:"When creating cool new abilities or game mechanics you often run into issues with the lack of good API. While I admit the dota 2 has massive API, it seems to focus on few very odd things or mechanics not fully exposed by default game. (Runes, Spell Stealing, Illusions). To fix those issues you might want to expand it. Here is one method of doing so.",source:"@site/_articles/abilities/lua-modifiers/1.md",sourceDirName:"abilities/lua-modifiers",slug:"/abilities/lua-modifiers/1",permalink:"/abilities/lua-modifiers/1",editUrl:"https://github.com/ModDota/moddota.github.io/edit/source/_articles/abilities/lua-modifiers/1.md",version:"current",frontMatter:{title:"Extending Hero/NPC API with lua modifiers",author:"DrTeaSpoon",steamId:"76561197975484185",date:"21.08.2016"},sidebar:"tutorials",previous:{title:"Lua Item Tutorial",permalink:"/abilities/lua-item-tutorial"},next:{title:"Linken's Sphere & Lotus Orb",permalink:"/abilities/lua-modifiers/2"}},s=[],l={toc:s};function u({components:e,...t}){return(0,a.kt)("wrapper",(0,o.Z)({},l,t,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"When creating cool new abilities or game mechanics you often run into issues with the lack of good API. While I admit the dota 2 has massive API, it seems to focus on few very odd things or mechanics not fully exposed by default game. (Runes, Spell Stealing, Illusions). To fix those issues you might want to expand it. Here is one method of doing so.\nIf you are using BMD's Barebones then you already have neatly exposed function ",(0,a.kt)("inlineCode",{parentName:"p"},"GameMode:OnHeroInGame(hero)")," in your ",(0,a.kt)("inlineCode",{parentName:"p"},"internal/gamemode.lua")," file. Otherwise you will want to listen to NPC spawning when initializing your game mode:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-lua"},'function Activate()\n  LinkLuaModifier( "heroes_base_mod", "lua_modifiers/hero_base_mod.lua", LUA_MODIFIER_MOTION_NONE )\n  ListenToGameEvent(\'npc_spawned\', Dynamic_Wrap(CModDotaTutorialsGameMode, \'OnNPC_Spawn\'), CModDotaTutorialsGameMode)\nend\n\nfunction CModDotaTutorialsGameMode:OnNPC_Spawn(keys)\n  local npc = EntIndexToHScript(keys.entindex)\n  if npc:IsRealHero() and npc.bInit == nil then\n    npc.bInit = true\n        OnHeroFirst_Spawn(npc)\n  end\nend\n\nfunction OnHeroFirst_Spawn(hero)\n  hero:AddNewModifier( hero, nil, "heroes_base_mod", {} )\nend\n')),(0,a.kt)("p",null,"NOTE: Keep in mind your gamemode's function name. I used ",(0,a.kt)("inlineCode",{parentName:"p"},"CModDotaTutorialsGameMode"),". You should probably have something else. Now lets get back to topic. As you noticed we used ",(0,a.kt)("inlineCode",{parentName:"p"},"LinkLuaModifier"),". We should create file it points to in your vscripts folder ",(0,a.kt)("inlineCode",{parentName:"p"},'"lua_modifiers/hero_base_mod.lua"'),"\nFor this example we are tracking what is the last spell player has cast. This could be used potentially as the building blocks for recreating Rubick's spell steal.\nIf you are unfamiliar with lua modifiers here is the only essential part of your modifier:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-lua"},"if heroes_base_mod == nil then\n    heroes_base_mod = class({})\nend\n")),(0,a.kt)("p",null,"Next we want to make sure the modifier is not disabled at any point:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-lua"},"function heroes_base_mod:GetAttributes()\n    return MODIFIER_ATTRIBUTE_PERMANENT + MODIFIER_ATTRIBUTE_IGNORE_INVULNERABLE\nend\n")),(0,a.kt)("p",null,"Here is the meat of our function's purpose. Track when this hero casts a spell."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-lua"},"function heroes_base_mod:DeclareFunctions()\n    local funcs = {\n        MODIFIER_EVENT_ON_ABILITY_EXECUTED\n    }\n    return funcs\nend\n\nfunction heroes_base_mod:OnAbilityExecuted(params)\n    if IsServer() then --Make sure we are doing this only server side.\n        if params.unit == self:GetParent() then --we only want the spells cast by this unit.\n            if not params.ability:IsItem() then --we don't want to track items.\n                self.lastability = params.ability --record the ability handle.\n            end\n        end\n    end\nend\n")),(0,a.kt)("p",null,"Now we get to the magic:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-lua"},'function heroes_base_mod:OnCreated(kv)\n    local hMod = self --we can only reference to "self" in our own function we pass this modifier to function we create for the unit.\n    local hParent = self:GetParent() --the unit.\n    if hParent.GetLastSpell == nil then --if for some odd reason there is already such function\n        function hParent:GetLastSpell() ---we create new function for the unit.\n            if hMod.lastability ~= nil then --if unit has cast any spells\n                return hMod.lastability --return the last ability.\n            else\n                return nil --in case there is nothing to return. this is sort of redundant.\n            end\n        end\n    end\nend\n')),(0,a.kt)("p",null,"Because we assume every hero having this modifier its kinda useless to show it on the screen."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-lua"},"function heroes_base_mod:IsHidden()\n    return true\nend\n")),(0,a.kt)("p",null,"Now that we have our modifier done. We want some way of testing it. I decided to go with simple console command. Add following to your game init function."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-lua"},'-- this is in function Activate()\n Convars:RegisterCommand( "mod_test_spells", Dynamic_Wrap(CModDotaTutorialsGameMode, \'PrintLastSpells\'), "Print last spell for every hero", FCVAR_CHEAT )\n')),(0,a.kt)("p",null,"Now the actual console command's function:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-lua"},"function CModDotaTutorialsGameMode:PrintLastSpells()\n  print( '** Last Spell **' )\n    local tList = HeroList:GetAllHeroes()\n    for k,v in pairs(tList) do\n        local s = v:GetLastSpell()\n        if s == nil then\n            print( v:GetName() .. ' has cast no spells yet.')\n        else\n            print( v:GetName() .. ' last cast ' .. v:GetLastSpell():GetAbilityName())\n        end\n    end\n  print( '****************' )\nend\n")),(0,a.kt)("p",null,"Now you should be able to use console command ",(0,a.kt)("inlineCode",{parentName:"p"},"mod_test_spells")," to print out the last spell every hero has used.\nNext topic: ",(0,a.kt)("a",{parentName:"p",href:"2"},"Linken Sphere & Lotus Orb.")))}u.isMDXComponent=!0},6010:(e,t,n)=>{function o(e){var t,n,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=o(e[t]))&&(a&&(a+=" "),a+=n);else for(t in e)e[t]&&(a&&(a+=" "),a+=t);return a}function a(){for(var e,t,n=0,a="";n<arguments.length;)(e=arguments[n++])&&(t=o(e))&&(a&&(a+=" "),a+=t);return a}n.d(t,{Z:()=>a})}}]);