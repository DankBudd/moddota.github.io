"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[6345],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>d});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=c(a),d=r,h=m["".concat(s,".").concat(d)]||m[d]||p[d]||i;return a?n.createElement(h,l(l({ref:t},u),{},{components:a})):n.createElement(h,l({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var c=2;c<i;c++)l[c]=a[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},3919:(e,t,a)=>{function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function r(e){return void 0!==e&&!n(e)}a.d(t,{b:()=>n,Z:()=>r})},4996:(e,t,a)=>{a.d(t,{C:()=>i,Z:()=>l});var n=a(2263),r=a(3919);function i(){const{siteConfig:{baseUrl:e="/",url:t}={}}=(0,n.Z)();return{withBaseUrl:(a,n)=>function(e,t,a,{forcePrependBaseUrl:n=!1,absolute:i=!1}={}){if(!a)return a;if(a.startsWith("#"))return a;if((0,r.b)(a))return a;if(n)return t+a;const l=a.startsWith(t)?a:t+a.replace(/^\//,"");return i?e+l:l}(t,e,a,n)}}function l(e,t={}){const{withBaseUrl:a}=i();return a(e,t)}},8215:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(7294);const r=function({children:e,hidden:t,className:a}){return n.createElement("div",{role:"tabpanel",hidden:t,className:a},e)}},1395:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(7294),r=a(944),i=a(6010);const l="tabItem_1uMI",o="tabItemActive_2DSg";const s=37,c=39;const u=function(e){const{lazy:t,block:a,defaultValue:u,values:p,groupId:m,className:d}=e,{tabGroupChoices:h,setTabGroupChoices:b}=(0,r.Z)(),[f,g]=(0,n.useState)(u),v=n.Children.toArray(e.children),k=[];if(null!=m){const e=h[m];null!=e&&e!==f&&p.some((t=>t.value===e))&&g(e)}const y=e=>{const t=e.currentTarget,a=k.indexOf(t),n=p[a].value;g(n),null!=m&&(b(m,n),setTimeout((()=>{(function(e){const{top:t,left:a,bottom:n,right:r}=e.getBoundingClientRect(),{innerHeight:i,innerWidth:l}=window;return t>=0&&r<=l&&n<=i&&a>=0})(t)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(o),setTimeout((()=>t.classList.remove(o)),2e3))}),150))},w=e=>{var t;let a;switch(e.keyCode){case c:{const t=k.indexOf(e.target)+1;a=k[t]||k[0];break}case s:{const t=k.indexOf(e.target)-1;a=k[t]||k[k.length-1];break}}null==(t=a)||t.focus()};return n.createElement("div",{className:"tabs-container"},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":a},d)},p.map((({value:e,label:t})=>n.createElement("li",{role:"tab",tabIndex:f===e?0:-1,"aria-selected":f===e,className:(0,i.Z)("tabs__item",l,{"tabs__item--active":f===e}),key:e,ref:e=>k.push(e),onKeyDown:w,onFocus:y,onClick:y},t)))),t?(0,n.cloneElement)(v.filter((e=>e.props.value===f))[0],{className:"margin-vert--md"}):n.createElement("div",{className:"margin-vert--md"},v.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==f})))))}},9443:(e,t,a)=>{a.d(t,{Z:()=>n});const n=(0,a(7294).createContext)(void 0)},944:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(7294),r=a(9443);const i=function(){const e=(0,n.useContext)(r.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},7840:(e,t,a)=>{a.d(t,{s:()=>r});var n=a(7294);function r({id:e,aspectRatio:t=4/3,hd:a="0"}){return n.createElement("p",{style:{position:"relative",paddingBottom:1/t*100+"%"}},n.createElement("iframe",{src:`https://gfycat.com/ifr/${e}?hd=${a}`,scrolling:"no",frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},8173:(e,t,a)=>{a.d(t,{s:()=>s});var n=a(2177),r=a(8215),i=a(1395),l=a(7294);const o={lua:"Lua",ts:"TypeScript",tsx:"TypeScript",js:"JavaScript",jsx:"JavaScript"};function s({children:e,group:t,titles:a}){(0,n.Z)("string"==typeof t||void 0===t);const s=l.Children.toArray(e).map(((e,t)=>{var n;const r=(null==(n=e.props.children.props.className)?void 0:n.replace(/language-/,""))??`Tab ${t+1}`;return{id:t,languageName:(void 0!==a&&a.length>0?a.split("|"):[])[t]??o[r]??r,element:e}}));return l.createElement(i.Z,{groupId:void 0!==t?`multi-code-block-${t}`:void 0,defaultValue:s[0].id,values:s.map((({id:e,languageName:t})=>({value:e,label:t})))},s.map((({id:e,element:t})=>l.createElement(r.Z,{key:e,value:e},t))))}},6776:(e,t,a)=>{a.d(t,{X:()=>i});var n=a(4996),r=a(7294);function i({path:e,controls:t=!1}){return r.createElement("video",{width:"100%",height:"100%",autoPlay:!0,muted:!0,loop:!0,controls:t},r.createElement("source",{src:(0,n.Z)(e),type:"video/mp4"}))}},8129:(e,t,a)=>{a.d(t,{_:()=>r});var n=a(7294);function r({id:e,playlistId:t,aspectRatio:a=16/9}){const r=void 0!==t?`https://www.youtube.com/embed/videoseries?list=${t}`:`https://www.youtube.com/embed/${e}`;return n.createElement("p",{style:{position:"relative",paddingBottom:1/a*100+"%"}},n.createElement("iframe",{src:r,frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},3701:(e,t,a)=>{a.r(t),a.d(t,{frontMatter:()=>i,metadata:()=>l,toc:()=>o,default:()=>c});var n=a(7462),r=(a(7294),a(3905));a(1395),a(8215),a(7840),a(8129),a(8173),a(6776);const i={title:"Custom Mana System",author:"Noya",steamId:"76561198046984233",date:"01.12.2014"},l={unversionedId:"scripting/custom-mana-system",id:"scripting/custom-mana-system",isDocsHomePage:!1,title:"Custom Mana System",description:"This is a guide to make a simple custom mana system. A working barebones addon is assumed.",source:"@site/_articles/scripting/custom-mana-system.md",sourceDirName:"scripting",slug:"/scripting/custom-mana-system",permalink:"/scripting/custom-mana-system",editUrl:"https://github.com/ModDota/moddota.github.io/edit/source/_articles/scripting/custom-mana-system.md",version:"current",frontMatter:{title:"Custom Mana System",author:"Noya",steamId:"76561198046984233",date:"01.12.2014"},sidebar:"tutorials",previous:{title:"Create Creature AttachWearable blocks directly from the keyvalues",permalink:"/units/create-creature-attachwearable-blocks-directly-from-the-keyvalues"},next:{title:"Item Restrictions & Requirements",permalink:"/scripting/item-restrictions-requirements"}},o=[{value:"Gain mana after an attack, scaling with level",id:"gain-mana-after-an-attack-scaling-with-level",children:[]},{value:"Gain mana after being attacked, scaling with level",id:"gain-mana-after-being-attacked-scaling-with-level",children:[]},{value:"Gain mana on particular spell cast",id:"gain-mana-on-particular-spell-cast",children:[]},{value:"Decrease mana over time, scaling with level",id:"decrease-mana-over-time-scaling-with-level",children:[]}],s={toc:o};function c({components:e,...t}){return(0,r.kt)("wrapper",(0,n.Z)({},s,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This is a guide to make a simple custom mana system. A working barebones addon is assumed. "),(0,r.kt)("p",null,"In this example we'll make a classic ",(0,r.kt)("em",{parentName:"p"},"Rage")," system, meaning:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"No normal mana regeneration, starting mana 0"),(0,r.kt)("li",{parentName:"ol"},"Gain mana after an attack, scaling with level "),(0,r.kt)("li",{parentName:"ol"},"Gain mana after being attacked, scaling with level"),(0,r.kt)("li",{parentName:"ol"},"Gain mana on particular spell cast"),(0,r.kt)("li",{parentName:"ol"},"Decrease mana over time, scaling with level")),(0,r.kt)("p",null,"Hope this is enough for most systems, let me know if you have another concept that I should add."),(0,r.kt)("p",null,"##No normal mana regeneration and start mana at 0\nThe easier approach is to nullify your hero's Intelligence\nFor this you'll need to set the following in your hero definition"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'//KV code inside npc_heroes_custom.txt\n"AttributeBaseIntelligence" "0" // Base intelligence\n"AttributeIntelligenceGain" "0" // Intelligence bonus per level.\n   \n"StatusMana"    "50"    // Initial Max Mana\n"StatsManaRegen"    "0" // Base Mana Regen (KV doesn\'t like negative numbers here) \n')),(0,r.kt)("p",null,"If you need to keep your Int stat but still have 0 natural mana regen, you'll need to apply modifiers for each Int point with negative mana regen to compensate. "),(0,r.kt)("p",null,"I won't be following this process in this guide, but you can check the guide ",(0,r.kt)("a",{parentName:"p",href:"https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Scripting/Using_Bitfields_To_Adjust_Stat_Value_Bonuses"},"on the wiki")),(0,r.kt)("p",null,"For your mana to start at 0, we'll begin by making the passive hidden ability which will be the base for our Rage system:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'//KV code inside npc_abilities_custom.txt\n"barbarian_rage" \n{\n    "BaseClass" "ability_datadriven"\n    "AbilityTextureName"    "barbarian_rage"\n    "MaxLevel" "1"\n    "AbilityBehavior"   "DOTA_ABILITY_BEHAVIOR_PASSIVE | DOTA_ABILITY_BEHAVIOR_HIDDEN"\n\n    "Modifiers"\n    { \n        "rage_modifier"\n        {\n            "Passive"   "1" //Auto apply this modifier when the spell is learned\n            "IsBuff"    "1" //Display as a green modifier\n            "IsHidden"  "0" //Show in the UI\n\n            "OnCreated"\n            {\n                "RunScript"\n                {\n                    "ScriptFile"    "barbarian.lua"\n                    "Function"  "ZeroManaOnSpawn"\n                }\n            }\n        }\n    }\n}\n')),(0,r.kt)("p",null,"This requires a barbarian.lua script inside ",(0,r.kt)("em",{parentName:"p"},"your_addon/scripts/vscripts")," folder.\nThe script is very simple:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"}," -- lua code inside barbarian.lua\n    function ZeroManaOnSpawn( event ) \n        local hero = event.caster\n        Timers:CreateTimer(.01, function()\n        -- Set Mana to 0 on created\n        hero:SetMana(0)\n    end)\n end\n")),(0,r.kt)("p",null,"We need to do a wait a bit for the hero to be properly spawned else it might fail. Notice the use of ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/bmddota/barebones/blob/source2/game/dota_addons/barebones/scripts/vscripts/timers.lua"},"BMD's Timers"),"."),(0,r.kt)("p",null,"###Before we continue:\nRight now our spell is not even available on the hero, and we want it to be learned when we spawn.\nFor this we'll need to add the following in our ",(0,r.kt)("inlineCode",{parentName:"p"},"OnHeroInGame"),(0,r.kt)("em",{parentName:"p"}," listener ("),"function hook of npc_spawned, see ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/bmddota/barebones/blob/source2/game/dota_addons/barebones/scripts/vscripts/barebones.lua#L443"},"barebones Event Hooks")," )"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"},'-- lua code inside OnHeroInGame(hero)\nlocal heroName = hero:GetUnitName()\nif heroName == "npc_dota_hero_beastmaster" then\n    -- Add the spell\n    hero:AddAbility("barbarian_rage")\n    -- Level it up\n    hero:FindAbilityByName("barbarian_rage"):SetLevel(1)\nend\n')),(0,r.kt)("p",null,"The if is not exactly neccessary but you'll need to filter your desired hero somehow. We'll use Beastmaster for our example"),(0,r.kt)("h2",{id:"gain-mana-after-an-attack-scaling-with-level"},"Gain mana after an attack, scaling with level"),(0,r.kt)("p",null,"Our rage_modifier block gains another modifier event:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"OnAttackLanded"\n{\n    "RunScript"\n    {\n        "ScriptFile"    "barbarian.lua"\n        "Function"  "ManaOnAttack"\n    }\n} \n')),(0,r.kt)("p",null,"I'll use a basic formula for it, which gives a base mana per attack but also scales with levels slightly.\nKeep in mind this function is used for a 200 hero level system, so if you have something different of bigger mana costs, you need to adjust to your liking."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"},"-- lua code inside barbarian.lua\nfunction ManaOnAttack( event )\n    local hero = event.caster\n    local level = hero:GetLevel()\n\n    hero:GiveMana(0.01 * level + 3)\nend\n")),(0,r.kt)("h2",{id:"gain-mana-after-being-attacked-scaling-with-level"},"Gain mana after being attacked, scaling with level"),(0,r.kt)("p",null,"Our modifier block gains another modifier event:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"OnAttacked"\n{\n   "RunScript"\n    {\n        "ScriptFile"    "barbarian.lua"\n        "Function"  "ManaOnAttacked"\n    }\n}\n')),(0,r.kt)("p",null,"Same as befefore, another different formula can be used, we will give a bit less mana on attacked"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"},"function ManaOnAttacked( event )\n   local hero = event.caster\n   local level = hero:GetLevel()\n\n   hero:GiveMana(0.01 * level + 0.4)\nend\n")),(0,r.kt)("h2",{id:"gain-mana-on-particular-spell-cast"},"Gain mana on particular spell cast"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"OnSpellStart" \n{\n    "RunScript"\n    { \n        "ScriptFile"    "barbarian.lua"\n        "Function"  "leap"\n    }\n}\n')),(0,r.kt)("p",null,"Then in your lua spell script we need to have this somewhere:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"},'local manaGain = event.ability:GetLevelSpecialValueFor("mana_gain", (event.ability:GetLevel()-1))\nevent.caster:GiveMana(manaGain)\n')),(0,r.kt)("p",null,"Note the relatively complicated GetLevelSpecialValueFor with a GetLevel()-1! "),(0,r.kt)("p",null,'This will take your "mana_gain" from AbilitySpecial, in my leap example it would be:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"AbilitySpecial"\n{\n    "01"\n    {\n        "var_type"  "FIELD_INTEGER"\n        "mana_gain" "8 16 25 35 47 60 72 85"\n    }\n}\n')),(0,r.kt)("p",null,'We need to use GetLevelSpecialValueFor because GetSpecialValueFor("mana_gain") only takes the first parameter (so it is only useful for non scaling specials)'),(0,r.kt)("h2",{id:"decrease-mana-over-time-scaling-with-level"},"Decrease mana over time, scaling with level"),(0,r.kt)("p",null,"In the beginning we had set our StatsManaRegen to 0. This is done to properly control the mana regen dinamically in our main lua file"),(0,r.kt)("p",null,"Base Mana Regen will need to be updated when the hero spawns ",(0,r.kt)("inlineCode",{parentName:"p"},"OnHeroInGame"),", and then each time he levels up ",(0,r.kt)("inlineCode",{parentName:"p"},"OnPlayerLevelUp")," if we want it to scale."),(0,r.kt)("p",null,"For this we create a local function somewhere inside our main addon lua file and call it whenever we need (at least once ",(0,r.kt)("inlineCode",{parentName:"p"},"OnHeroInGame"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"},"function AdjustWarriorClassMana( hero ) \n    Timers:CreateTimer(0.1,function() \n        local heroLevel = hero:GetLevel()\n        -- Adjust the new mana regen\n        hero:SetBaseManaRegen( -(0.01 * heroLevel) - 0.25)\n    end)\nend\n\n")),(0,r.kt)("p",null,"With this, our hero's mana will decrease over time by ~0.3 and slightly faster on higher levels."),(0,r.kt)("p",null,"I hope I covered everything and kept a middle ground explanation style for those who are new to scripted abilities, without boring those who aren't."),(0,r.kt)("p",null,"Thanks for reading, feel free to ask any questions or discuss variations of mana systems."),(0,r.kt)("p",null,"Check the original complete file scripts in TBR Github"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/Aleteh/TBR3/blob/master/scripts/vscripts/tbr.lua"},"main lua scripts"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/Aleteh/TBR3/blob/master/scripts/vscripts/abilities/barbarian.lua"},"barbarian lua scripts"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/Aleteh/TBR3/blob/master/scripts/npc/npc_heroes_custom.txt"},"heroes_custom file"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/Aleteh/TBR3/blob/master/scripts/npc/npc_abilities_custom.txt"},"abilities file")))))}c.isMDXComponent=!0},6010:(e,t,a)=>{function n(e){var t,a,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(r&&(r+=" "),r+=a);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}function r(){for(var e,t,a=0,r="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}a.d(t,{Z:()=>r})}}]);