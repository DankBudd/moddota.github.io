(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{114:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return s}));var r=n(2),a=(n(0),n(186));n(181),n(182),n(187),n(188),n(189);const i={title:"Enchanting Trees",author:"DrTeaSpoon",steamId:"76561197975484185",date:"08.09.2016"},o={id:"abilities/lua-modifiers/4",isDocsHomePage:!1,title:"Enchanting Trees",description:"Without further delay. Lets get to it!",source:"@site/_articles/abilities/lua-modifiers/4.md",permalink:"/abilities/lua-modifiers/4",editUrl:"https://github.com/ModDota/moddota.github.io/edit/source/_articles/abilities/lua-modifiers/4.md",sidebar:"tutorials",previous:{title:"Transformations",permalink:"/abilities/lua-modifiers/3"},next:{title:"Reutilizing Built-In Modifiers",permalink:"/abilities/reutilizing-built-in-modifiers"}},l=[],c={rightToc:l};function s({components:e,...t}){return Object(a.b)("wrapper",Object(r.a)({},c,t,{components:e,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Without further delay. Lets get to it!",Object(a.b)("br",{parentName:"p"}),"\n",Object(a.b)("inlineCode",{parentName:"p"},"npc_abilities_custom.txt")," entry for our ability."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),'"enchant_tree_lua"\n{\n    // These are required for this to work\n    "BaseClass"             "ability_lua"\n    "ScriptFile"                    "lua_abilities/enchant_tree/ability.lua" //set your script file path in \'vscripts\' folder\n    "AbilityBehavior"               "DOTA_ABILITY_BEHAVIOR_UNIT_TARGET"\n    "AbilityUnitTargetTeam"         "DOTA_UNIT_TARGET_TEAM_CUSTOM"\n    "AbilityUnitTargetType"         "DOTA_UNIT_TARGET_TREE"\n    "AbilityDuration"               "10.0" //well, technically optional.\n    // Optional stuff\n    "AbilityTextureName"            "enchant_tree_lua"\n    "AbilityCastPoint"              "0.1"\n    "AbilityCooldown"               "5.0"\n    "AbilityManaCost"               "100"\n    "AbilityCastRange"              "400"\n}\n')),Object(a.b)("p",null,"This is your basic start for lua ability."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),'if enchant_tree_lua == nil then\n    enchant_tree_lua = class({})\nend\nLinkLuaModifier( "enchant_tree_lua_mod", "lua_abilities/enchant_tree/modifier.lua", LUA_MODIFIER_MOTION_NONE )\n')),Object(a.b)("p",null,"The magic happens here. ",Object(a.b)("inlineCode",{parentName:"p"},"CreateModifierThinker")," creates sort of invisible unit with modifier attached to it."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),'function enchant_tree_lua:OnSpellStart()\n    CreateModifierThinker( self:GetCaster(), self, "enchant_tree_lua_mod", { duration = self:GetDuration() }, self:GetCursorPosition(), self:GetCaster():GetTeamNumber(), true )\nend\n')),Object(a.b)("p",null,'Now for the next piece of magic we need to setup our cool modifier. In this example the file path would be "vscripts/lua_abilities/enchant_tree/modifier.lua".',Object(a.b)("br",{parentName:"p"}),"\n","There are two major parts for every 'tree enchantment'. First is making sure that we have tree nearby. Because of engine limitations the trees are difficult to interact with. For our solution we are simply requesting from gridnav every half a second if there is trees in very small area at our thinker unit's location.",Object(a.b)("br",{parentName:"p"}),"\n","The last part is minor optimization that may become redundant but was not at the time of developing this. There was issue where the thinker unit would remain on the map for some time after the modifier was destroyed."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),"if enchant_tree_lua_mod == nil then\n    enchant_tree_lua_mod = class({})\nend\nfunction enchant_tree_lua_mod:OnCreated( kv )   \n    if IsServer() then\n        self:StartIntervalThink(0.5)\n    end\nend\nfunction enchant_tree_lua_mod:OnIntervalThink()\n    if IsServer() then\n        if not GridNav:IsNearbyTree(self:GetParent():GetAbsOrigin(), 10, false) then\n            self:Destroy()\n        end\n    end\nend\nfunction enchant_tree_lua_mod:OnDestroy()\n    if IsServer() then\n        UTIL_Remove( self:GetParent() )\n    end\nend\n")),Object(a.b)("p",null,"Now comes the fun part. What do we want to do with this modifier.",Object(a.b)("br",{parentName:"p"}),"\n","I decided to go with soul collecting tree: if enemy hero is killed in radius(you need to add this to special values of your ",Object(a.b)("inlineCode",{parentName:"p"},"npc_abilities_custom.txt"),") the owner of the spell steal up to 2 of victim's primary stat."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),'function enchant_tree_lua_mod:DeclareFunctions()\n    local funcs = {\n        MODIFIER_EVENT_ON_HERO_KILLED\n    }\n    return funcs\nend\n\nfunction enchant_tree_lua_mod:OnHeroKilled(kv)\n    if IsServer() then\n        if kv.unit and kv.unit:GetTeam() ~= self:GetCaster():GetTeam() then\n            if (self:GetParent():GetAbsOrigin() - kv.unit:GetAbsOrigin()):Length2D() <= self:GetAbility():GetSpecialValueFor("radius") then\n                self:CollectSoul(kv.unit)\n            end\n        end\n    end\nend\n\nfunction enchant_tree_lua_mod:CollectSoul(hTarget)\n  local primary = hTarget:GetPrimaryAttribute()\n  local val = hTarget:GetPrimaryStatValue()\n  local n = math.max (0, math.min(2,val))\n  if primary == 0 then\n    self:GetCaster():ModifyStrength(n) \n    hTarget:ModifyStrength(n*-1) \n  elseif primary == 1 then\n    self:GetCaster():ModifyAgility(n) \n    hTarget:ModifyAgility(n*-1) \n  else\n    self:GetCaster():ModifyIntellect(n) \n    hTarget:ModifyIntellect(n*-1) \n  end\nend\n')),Object(a.b)("p",null,"For those fancy effects that ironwood tree has you might want to add these lines"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),'function enchant_tree_lua_mod:GetEffectName()\n return "particles/items_fx/ironwood_tree.vpcf"\nend\n\nfunction enchant_tree_lua_mod:GetEffectAttachType()\n return PATTACH_OVERHEAD_FOLLOW\nend\n')),Object(a.b)("p",null,"Next Topic: ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"lua-modifiers-5"}),"Stacking Modifiers")))}s.isMDXComponent=!0},181:function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(185),o=n(183),l=n(90),c=n.n(l);const s=37,u=39;t.a=function(e){const{block:t,children:n,defaultValue:l,values:f,groupId:p}=e,{tabGroupChoices:d,setTabGroupChoices:b}=Object(i.a)(),[m,h]=Object(r.useState)(l);if(null!=p){const e=d[p];null!=e&&e!==m&&f.some(t=>t.value===e)&&h(e)}const y=e=>{h(e),null!=p&&b(p,e)},O=[];return a.a.createElement("div",null,a.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(o.a)("tabs",{"tabs--block":t})},f.map(({value:e,label:t})=>a.a.createElement("li",{role:"tab",tabIndex:"0","aria-selected":m===e,className:Object(o.a)("tabs__item",c.a.tabItem,{"tabs__item--active":m===e}),key:e,ref:e=>O.push(e),onKeyDown:e=>((e,t,n)=>{switch(n.keyCode){case u:((e,t)=>{const n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()})(e,t);break;case s:((e,t)=>{const n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()})(e,t)}})(O,e.target,e),onFocus:()=>y(e),onClick:()=>y(e)},t))),a.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},r.Children.toArray(n).filter(e=>e.props.value===m)[0]))}},182:function(e,t,n){"use strict";var r=n(0),a=n.n(r);t.a=function(e){return a.a.createElement("div",null,e.children)}},183:function(e,t,n){"use strict";function r(e){var t,n,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=r(e[t]))&&(a&&(a+=" "),a+=n);else for(t in e)e[t]&&(a&&(a+=" "),a+=t);return a}t.a=function(){for(var e,t,n=0,a="";n<arguments.length;)(e=arguments[n++])&&(t=r(e))&&(a&&(a+=" "),a+=t);return a}},184:function(e,t,n){"use strict";var r=n(0);const a=Object(r.createContext)({tabGroupChoices:{},setTabGroupChoices:()=>{},isAnnouncementBarClosed:!1,closeAnnouncementBar:()=>{}});t.a=a},185:function(e,t,n){"use strict";var r=n(0),a=n(184);t.a=function(){return Object(r.useContext)(a.a)}},186:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return b}));var r=n(0),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=a.a.createContext({}),u=function(e){var t=a.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},f=function(e){var t=u(e.components);return a.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),f=u(n),d=r,b=f["".concat(o,".").concat(d)]||f[d]||p[d]||i;return n?a.a.createElement(b,l(l({ref:t},s),{},{components:n})):a.a.createElement(b,l({ref:t},s))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},187:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),a=n.n(r);function i({id:e,aspectRatio:t=4/3}){return a.a.createElement("p",{style:{position:"relative",paddingBottom:1/t*100+"%"}},a.a.createElement("iframe",{src:"https://gfycat.com/ifr/"+e,scrolling:"no",frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},188:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),a=n.n(r);function i({id:e,playlistId:t,aspectRatio:n=16/9}){const r=void 0!==t?"https://www.youtube.com/embed/videoseries?list="+t:"https://www.youtube.com/embed/"+e;return a.a.createElement("p",{style:{position:"relative",paddingBottom:1/n*100+"%"}},a.a.createElement("iframe",{src:r,frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},189:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(3),a=n(182),i=n(181),o=n(0),l=n.n(o);const c={ts:"TypeScript",tsx:"TypeScript",js:"JavaScript",jsx:"JavaScript"};function s({children:e,group:t}){Object(r.a)("string"==typeof t||null===t);const n=l.a.Children.toArray(e).map(e=>{const t=e.props.children.props.className.replace(/language-/,"");return Object(r.a)(t in c),{language:t,element:e}});return l.a.createElement(i.a,{groupId:null!==t?"multi-code-block-"+t:void 0,defaultValue:n[0].language,values:n.map(({language:e})=>({value:e,label:c[e]}))},n.map(({language:e,element:t})=>l.a.createElement(a.a,{key:e,value:e},t)))}}}]);