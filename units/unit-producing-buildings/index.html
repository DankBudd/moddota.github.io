<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="search" type="application/opensearchdescription+xml" title="ModDota" href="/opensearch.xml"><title data-react-helmet="true">Unit producing buildings | ModDota</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Unit producing buildings | ModDota"><meta data-react-helmet="true" name="description" content="This is a response tutorial on @Lemon30 question thread, I&#x27;m gonna explain the scripting approaches to fully spawning units with a building, including making them controllable and defining initial orders."><meta data-react-helmet="true" property="og:description" content="This is a response tutorial on @Lemon30 question thread, I&#x27;m gonna explain the scripting approaches to fully spawning units with a building, including making them controllable and defining initial orders."><meta data-react-helmet="true" property="og:url" content="https://moddota.com/units/unit-producing-buildings"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://moddota.com/units/unit-producing-buildings"><link rel="stylesheet" href="/styles.32eaf7f3.css">
<link rel="stylesheet" href="/main.49954070.css">
<link rel="preload" href="/styles.bfce4c50.js" as="script">
<link rel="preload" href="/runtime~main.2ba08dfb.js" as="script">
<link rel="preload" href="/main.928bda27.js" as="script">
<link rel="preload" href="/1.656d2891.js" as="script">
<link rel="preload" href="/2.3fc14b95.js" as="script">
<link rel="preload" href="/1be78505.69574c30.js" as="script">
<link rel="preload" href="/ec1ed54d.f1f64d91.js" as="script">
<link rel="preload" href="/a9d58478.70277fe8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/images/logo-80x80.png"><strong class="navbar__title">ModDota</strong></a><a class="navbar__item navbar__link" href="/tutorials">Tutorials</a><a href="https://dota.tools/vscripts/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Lua API</a><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama/Javascript/API" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Panorama API</a></div><div class="navbar__items navbar__items--right"><a href="https://discord.gg/gRmZgvz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/images/logo-80x80.png"><strong class="navbar__title">ModDota</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tutorials">Tutorials</a></li><li class="menu__list-item"><a href="https://dota.tools/vscripts/" target="_blank" rel="noopener noreferrer" class="menu__link">Lua API</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama/Javascript/API" target="_blank" rel="noopener noreferrer" class="menu__link">Panorama API</a></li><li class="menu__list-item"><a href="https://discord.gg/gRmZgvz" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1jis"><div class="docSidebarContainer_1kjN"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/scripting-introduction">Scripting Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Abilities, items, modifiers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/ability-keyvalues">Ability KeyValues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/item-keyvalues">Item KeyValues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/the-importance-of-abilityspecial-values">The importance of AbilitySpecial values</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/passing-abilityspecial-values-into-lua">Passing AbilitySpecial values into Lua</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/abilityduration-tooltips">AbilityDuration tooltips</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/simple-custom-ability">Simple Custom Ability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/creating-innate-abilities">Creating innate (available from level 1) abilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/making-any-ability-use-charges">Making any ability use charges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/calling-spells-with-setcursor">Calling Spells with SetCursor</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Lua_Abilities_and_Modifiers" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Lua_Abilities_and_Modifiers" tabindex="-1">Lua Abilities and Modifiers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/lua-item-tutorial">Lua Item Tutorial</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Lua Modifiers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/lua-modifiers/1">Extending Hero/NPC API with lua modifiers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/lua-modifiers/2">Linken&#x27;s Sphere &amp; Lotus Orb</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/lua-modifiers/3">Transformations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/lua-modifiers/4">Enchanting Trees</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/reutilizing-built-in-modifiers">Reutilizing Built-In Modifiers</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Datadriven</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/datadriven-ability-events-modifiers">DataDriven Ability Events &amp; Modifiers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/all-about-the-target">All about the Target</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/channeling-animations">Channeling Animations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/invisibility-ability-example">Invisibility Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/illusion-ability-example">Illusion Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/rotate-ability-example">Rotate Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/point-channeling-aoe-ability-example">Point Channeling AoE Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/apply-hero-and-creep-modifier-durations">Apply Hero and Creep modifier durations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/physics-ability-example-exorcism">Physics Ability Example - Exorcism</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Units</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/units/unit-keyvalues">Unit KeyValues</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/units/unit-producing-buildings">Unit producing buildings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/units/creating-units-with-a-duration">Creating units with a duration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/units/adding-a-very-simple-ai-to-units">Adding a Very Simple AI to Units</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/units/simple-neutral-ai">Writing a simple AI for neutrals</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/units/create-creature-attachwearable-blocks-directly-from-the-keyvalues">Create Creature AttachWearable blocks directly from the keyvalues</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Scripting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/custom-mana-system">Custom Mana System</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/item-restrictions-requirements">Item Restrictions &amp; Requirements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/item-drop-system">Item Drop System</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/making-a-rpg-like-looting-chest">Making a &quot;rpg-like&quot; looting chest</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/scripted-shop-spawning">Scripted Shop Spawning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/lava-damage">Lava damage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/using-dota-filters">Using the order filter and other filters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/particle-attachment">Particle Attachment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/precache-fixing-and-avoiding-issues">Precache, Fixing and avoiding issues</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Nettables" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Nettables" tabindex="-1">Custom NetTables</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Panorama UI</a><ul class="menu__list"><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama" tabindex="-1">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/inclusive-panorama-ui">Inclusive Panorama UI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/introduction-to-panorama-ui-with-typescript">Introduction to Panorama UI with TypeScript</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/keybindings">Keybindings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/dotascenepanel">DOTAScenePanel</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/button-examples">Button Examples</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Game_Setup" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Game_Setup" tabindex="-1">Custom Game Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/hiding-hud-with-sethudvisible">Hiding HUD with SetHUDVisible</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Assets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/asset-file-type-reference">Asset File Type Reference</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Maps</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/maps/hammer-tutorials">Hammer Tutorials</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/maps/making-skip-clip-blocks-out-of-models">Making skip/clip blocks out of models</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Models</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/importing-custom-models">Importing custom models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/mdl-to-vmdl-conversion">MDL to VMDL Conversion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/adding-hitbox-to-models-without-a-bone">Adding Hitbox to Models without a Bone</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/importing-models-and-using-material-editor">Importing models and using the material editor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/exporting-models-and-materials-textures">Exporting Models and Materials/Textures</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/custom-hero-models-materials-animations">Custom Hero models, materials and animations</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Particles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/particle-basics">Particle Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/chaos-wave-particle">Chaos Wave Particle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/falling-cherry-blossom-petal-for-spring-mood-particle">Falling cherry blossom petal for spring mood particle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/volcano-particle">Volcano Particle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/status-effects">Status Effects</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/custom-sounds">Custom Sounds</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/extracting-and-compiling-vtex-files">Extracting and Compiling VTEX files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/custom-minimap-icons">Custom Minimap Icons</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tools/useful-console-commands">Useful Console Commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tools/setting-up-your-addon-with-github">Setting Up Your Addon With GitHub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tools/combining-kv-files-using-base">Combining KV files using #base</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/contribute">Contribute</a></li></ul></div></div></div><main class="docMainContainer_3j_A"><div class="container padding-vert--lg docItemWrapper_1Hme"><div class="row"><div class="col docItemCol_2AGf"><div class="docItemContainer_1tAC"><article><div style="margin-top:-10px;margin-bottom:10px"><div class="row"><div class="col"><a href="https://github.com/ModDota/moddota.github.io/edit/source/_articles/units/unit-producing-buildings.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Created on <time datetime="2015-03-08T00:00:00.000Z" class="docLastUpdatedAt_1gIo">3/8/2015</time> by <strong><a href="https://steamcommunity.com/profiles/76561198046984233">Noya</a></strong></small></em></div></div></div><header><h1 class="docTitle_cWlf">Unit producing buildings</h1></header><div class="markdown"><p>This is a response tutorial on @Lemon30 <a href="https://moddota.com/forums/discussion/168/unit-producing-buildings-how-do-they-work" target="_blank" rel="noopener noreferrer">question thread</a>, I&#x27;m gonna explain the scripting approaches to fully spawning units with a building, including making them controllable and defining initial orders.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="step-1-the-npc_units_customtxt-files"></a>Step 1: The npc_units_custom.txt files<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-1-the-npc_units_customtxt-files" title="Direct link to heading">#</a></h2><p>First of all, you&#x27;ll need a KeyValue definition for a building and the unit you want to spawn.</p><p>There are many examples of units in <a href="https://github.com/MNoya/Warchasers/blob/master/scripts/npc/npc_units_custom.txt">Warchasers</a> &amp; <a href="https://github.com/MNoya/DotaCraft/tree/master/scripts/npc/units" target="_blank" rel="noopener noreferrer">DotaCraft</a> repositories, so I don&#x27;t think I need to explain much about this.</p><p>I want to make one special note here though. <strong>&quot;BaseClass&quot; &quot;npc_dota_building&quot; can be seen through fog</strong>. </p><p>So if you have a problem with this, don&#x27;t make your unit a building, but a <strong>npc_dota_creature instead</strong>. </p><p>This has the issue of creatures having a turn rate, so additionally you&#x27;ll need to apply a MODIFIER_STATE_STUNNED on them, make the Magic Immune so most spells don&#x27;t damage them, and make an special rule for spells that are supposed to damage buildings this way.</p><p>That being said, we won&#x27;t be bothering with that for the purpose of this tutorial.</p><p>I&#x27;ll be using a simplified version of the <a href="https://pastebin.com/z5Jk9W17" target="_blank" rel="noopener noreferrer">human_barracks</a> definition, with a &quot;human_train_footman&quot; ability, which I&#x27;ll expand on the possibilities for it later.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="step-2-putting-your-unit-into-the-map"></a>Step 2: Putting your unit into the map.<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-2-putting-your-unit-into-the-map" title="Direct link to heading">#</a></h2><p>There are 2 main options for doing this, one is Hammer oriented, and the other is a fully scripted approach.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="hammer-units"></a>Hammer Units<a aria-hidden="true" tabindex="-1" class="hash-link" href="#hammer-units" title="Direct link to heading">#</a></h3><p>As described in the first thread, you can point and click to add a unit to the map, with all sort of properties. </p><p>The problem with this approach is that even though the building is &quot;part of your team&quot;, you have no control over it, the same way you can&#x27;t control the autoattacks of Towers in Dota.</p><p>To solve this, we need to use a couple of lines in lua, basically the <code>SetOwner</code> and <code>SetControllableByPlayer</code> <a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Scripting/API#CBaseEntity" target="_blank" rel="noopener noreferrer">API functions</a>.</p><p><code>[CBaseEntity] void SetOwner( handle_owningEntity )</code> <strong>-- Sets this entity&#x27;s owner</strong></p><p><code>[CDOTA_BaseNPC] void SetControllableByPlayer( int, bool )</code> <strong>-- Set this unit controllable by a player.</strong></p><p>To properly call these functions, I&#x27;m gonna assume you already know the basics explained under the <a href="/articles/beginners-guide-to-dota-scripting">Beginners Guide to Scripting</a> and just explain where should you call these with an example.</p><p>A good GameMode hook to call these would be after the dota_player_picked_hero, so given a standard barebones listener like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">ListenToGameEvent(&#x27;dota_player_pick_hero&#x27;, Dynamic_Wrap(GameMode, &#x27;OnPlayerPickHero&#x27;), self)</span></div></div></div></div></div><p>In OnPlayerPickHero you need to <strong>find the handle of the BaseEntity/BaseNPC</strong>, that is, the unit you want to change ownership and control state.</p><p>This can be done in a couple of ways, for example, using the functions defined under <a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Scripting/API#CEntities" target="_blank" rel="noopener noreferrer">CEntities</a>. We want this building to have a unique identifier so its easy to search it, so inside Hammer, select it, go into its properties, and give it a name (I use the Alt+Enter hotkey for this):</p><p><img src="https://puu.sh/gs6Ec/c0a81f34ae.jpg" alt="img"></p><p>Now you can search the building and get a local variable to it with this line:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">local building = Entities:FindByName(nil, &quot;building_barracks1&quot;)</span></div></div></div></div></div><p>Note: <strong>Remember to select Entities when building the map</strong>!</p><p>The OnPlayerPickHero function should then look like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function GameMode:OnPlayerPickHero(keys)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hero = EntIndexToHScript(keys.heroindex)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local player = EntIndexToHScript(keys.player)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local playerID = hero:GetPlayerID()</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local building = Entities:FindByName(nil, &quot;building_barracks1&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    building:SetOwner(hero)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    building:SetControllableByPlayer(playerID, true)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now your building should be fully controllable for ability usage, and even subtract gold from the player if you use abilities with gold cost.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="scripting-approach"></a>Scripting Approach<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scripting-approach" title="Direct link to heading">#</a></h3><p>Hey Hammer is good and everything, but it&#x27;s behavior is very static. You need to have predefined position for the units, build the map everytime you make a change, and can&#x27;t choose to not spawn any of them if there are less players than expected, etc.</p><p>There is a fully scripted method for placing units on the map, which is done by using the <code>CreateUnitByName</code> function, with some additional perks.</p><p><code>handle CreateUnitByName( szUnitName, vLocation, bFindClearSpace, hNPCOwner, hUnitOwner, iTeamNumber )</code></p><p>Still working inside the same OnPlayerPickHero, we can either make an static position for each playerID, such as <em>Vector(450,322,128)</em>, doing random positions with named info_target entities in Hammer, or a dynamic position based on the hero spawn location. Let&#x27;s do the latter:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">local origin = hero:GetAbsOrigin() -- Spawn position</span></div><div class="token-line" style="color:#393A34"><span class="token plain">local fv = hero:GetForwardVector() -- Vector the hero is facing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">local distance = 300 </span></div><div class="token-line" style="color:#393A34"><span class="token plain">local position = origin + fv * distance</span></div></div></div></div></div><p>This will define a Vector facing 300 units to the direction the hero is facing.</p><p>Now, CreateUnitByName should then be called in this way:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">local building = CreateUnitByName(&quot;human_barracks&quot;, position, true, hero, hero, hero:GetTeamNumber())</span></div></div></div></div></div><p>Even though we set the hNPCOwner and hUnitOwner, the SetOwner and SetControllableByPlayer are still necessary.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="building-invulnerability"></a>Building invulnerability<a aria-hidden="true" tabindex="-1" class="hash-link" href="#building-invulnerability" title="Direct link to heading">#</a></h4><p>There&#x27;s an small issue with npc_dota_building baseclass which is that they spawn with &quot;modifier_invulnerable&quot; by default, to get rid of this, run this line:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">building:RemoveModifierByName(&quot;modifier_invulnerable&quot;)</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="did-i-mention-buildings-are-retarded"></a>Did I mention Buildings are retarded?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#did-i-mention-buildings-are-retarded" title="Direct link to heading">#</a></h4><p>There&#x27;s another issue, buildings will sometimes be not created where you want them to be, and instead be stuck to the (0,0,0) position, so, if this happens, add this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Timers:CreateTimer(function() building:SetAbsOrigin(position) end)</span></div></div></div></div></div><p>Wait 1 frame, and using BMD&#x27;s timers4life, your building will finally appear in the correct position</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="precache"></a>Precache<a aria-hidden="true" tabindex="-1" class="hash-link" href="#precache" title="Direct link to heading">#</a></h4><p>Last thing is the Unit&#x27;s Precache requirement. Unlike units dropped on Hammer, lua CreateUnitByName won&#x27;t run the precache {} blocks of the unit abilities nor Model, so we need to do it manually in either addon_game_mode.lua or in PostLoadPrecache() if you are worried about your clients not loading properly. I&#x27;ll just go with the first method in this case:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function Precache( context ) -- Find this in addon_game_mode.lua</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    PrecacheUnitByNameSync(&quot;human_barracks&quot;, context)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Done! Full code of the building spawning on front of the hero looks like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function GameMode:OnPlayerPickHero(keys)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hero = EntIndexToHScript(keys.heroindex)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local player = EntIndexToHScript(keys.player)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local playerID = hero:GetPlayerID()</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    -- Choose a Position</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local origin = hero:GetAbsOrigin() -- Spawn position</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local fv = hero:GetForwardVector() -- Vector the hero is facing</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local distance = 300 </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local position = origin + fv * distance</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    -- Spawning</span></div><div class="token-line" style="color:#393A34"><span class="token plain">local building = CreateUnitByName(&quot;human_barracks&quot;, position, true, hero, hero, hero:GetTeamNumber())</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    building:SetOwner(hero)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    building:SetControllableByPlayer(playerID, true)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    building:SetAbsOrigin(position)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    building:RemoveModifierByName(&quot;modifier_invulnerable&quot;)</span></div></div></div></div></div><br><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="step-3-scripting-the-unit-spawning-ability-inside-the-building"></a>Step 3: Scripting the unit-spawning ability inside the building<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-3-scripting-the-unit-spawning-ability-inside-the-building" title="Direct link to heading">#</a></h2><p>Now that we have a fully working building ingame, let&#x27;s move to npc_abilities_custom.txt and creature spawning from this building.</p><p>There are 2 main ways of doing this: with the DataDriven Action &quot;SpawnUnit&quot;, or just with the <code>CreateUnitByName</code> Lua function as explained before. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="datadriven-spawnunit"></a>DataDriven &quot;SpawnUnit&quot;<a aria-hidden="true" tabindex="-1" class="hash-link" href="#datadriven-spawnunit" title="Direct link to heading">#</a></h3><p>I actually prefer this DD Action and use it extensively thorough all of DotaCraft&#x27;s unit spawning, because it has access to the very useful <code>&quot;OnSpawn&quot;</code> Sub-Event, which is only accessible through this action, and has some other options for unit count, limit (so you can&#x27;t have more than X units of the same unit at the same time), modifier_kill integration, etc.</p><p>Of course you could listen to the game event of unit spawned and do your OnSpawn stuff there, but that makes the ability less modular and harder to maintain.</p><p>SpawnUnit should be used as it follows, and is included in the Sublime Dota KV snippets:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">&quot;SpawnUnit&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;UnitName&quot;       &quot;npc_name&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;Target&quot;         &quot;CASTER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;Duration&quot;       &quot;%duration&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;UnitCount&quot;      &quot;1&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;UnitLimit&quot;      &quot;0&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;GrantsGold&quot;     &quot;1&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;GrantsXP&quot;       &quot;1&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;SpawnRadius&quot;    &quot;10&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;OnSpawn&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ApplyModifier&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;ModifierName&quot;  &quot;modifier_phased&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;Target&quot;        &quot;TARGET&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;Duration&quot;      &quot;0.03&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        [ACTIONS]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div><p>Applying &quot;modifier_phased&quot; for 1 frame is to prevent units getting stuck, for example if you cast the ability directly on the caster, without the phasing, it will be stuck on the same point and both units will be unable to move. This is similar to running the Lua <code>FindClearSpaceForUnit</code>, because once the phasing ends, units will try to find an empty position.</p><p>Units created by this function are already under control of the owner of the building.</p><p>Inside the &quot;OnSpawn&quot; replacing the [ACTIONS], it&#x27;s useful to send orders to the unit, which can be referenced in lua as the event.target.</p><p>Here is a full example:</p><p><a href="https://pastebin.com/9g316n5A" target="_blank" rel="noopener noreferrer">https://pastebin.com/9g316n5A</a></p><p>The footman unit definition is just a Dragon Knight with some wearables, <a href="https://pastebin.com/XW3wWmhd" target="_blank" rel="noopener noreferrer">I copied it here</a>.</p><p>Note the usage of a RunScript to call a MoveToRallyPoint function, this will introduce the 4th and last step of this guide.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="orders"></a>Orders<a aria-hidden="true" tabindex="-1" class="hash-link" href="#orders" title="Direct link to heading">#</a></h2><p>Various orders can be run after the unit spawns. </p><p>Try to use the <code>ExecuteOrderFromTable</code> to avoid dropping orders because the unit is doing something else (like spawning), if you want to use easier functions like <code>MoveToPosition</code> you might need to add timers to make sure the unit is ready to perform the order.</p><p>Also, the Ownership of the unit needs to be changed to the <strong>hero handle</strong>, because the caster is a creature and those can&#x27;t gain gold!</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function MoveToRallyPoint( event )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local caster = event.caster</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local target = event.target</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    -- Change this to your desired Vector, usually as an hscript:GetAbsOrigin()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local position = Vector(420,322,128) </span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ExecuteOrderFromTable({ UnitIndex = target:GetEntityIndex(), </span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            OrderType = DOTA_UNIT_ORDER_MOVE_TO_POSITION,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            Position = position, Queue = true })</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    print(target:GetUnitName()..&quot; moving to position&quot;,position)</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local player = caster:GetPlayerOwner()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hero = player:GetAssignedHero()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    target:SetOwner(hero)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><hr><br>That&#x27;s it for now, post any doubts about anything below. Thanks for reading!</div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/units/unit-keyvalues"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Unit KeyValues</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/units/creating-units-with-a-duration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Creating units with a duration »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_tVyB"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#step-1-the-npc_units_customtxt-files" class="table-of-contents__link">Step 1: The npc_units_custom.txt files</a></li><li><a href="#step-2-putting-your-unit-into-the-map" class="table-of-contents__link">Step 2: Putting your unit into the map.</a><ul><li><a href="#hammer-units" class="table-of-contents__link">Hammer Units</a></li><li><a href="#scripting-approach" class="table-of-contents__link">Scripting Approach</a></li></ul></li><li><a href="#step-3-scripting-the-unit-spawning-ability-inside-the-building" class="table-of-contents__link">Step 3: Scripting the unit-spawning ability inside the building</a><ul><li><a href="#datadriven-spawnunit" class="table-of-contents__link">DataDriven &quot;SpawnUnit&quot;</a></li></ul></li><li><a href="#orders" class="table-of-contents__link">Orders</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/styles.bfce4c50.js"></script>
<script src="/runtime~main.2ba08dfb.js"></script>
<script src="/main.928bda27.js"></script>
<script src="/1.656d2891.js"></script>
<script src="/2.3fc14b95.js"></script>
<script src="/1be78505.69574c30.js"></script>
<script src="/ec1ed54d.f1f64d91.js"></script>
<script src="/a9d58478.70277fe8.js"></script>
</body>
</html>