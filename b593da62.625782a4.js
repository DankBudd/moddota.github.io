(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{147:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return a})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return c}));var r=n(2),i=(n(0),n(173));n(174),n(175);const a={title:"Linken's Sphere & Lotus Orb",author:"DrTeaSpoon",steamId:"76561197975484185",date:"22.08.2016"},o={id:"abilities/lua-modifiers/2",title:"Linken's Sphere & Lotus Orb",description:"When you script your targeted lua abilities you may have had issue of the protection against such spells not working. Linken Sphere and Lotus Orb.",source:"@site/_articles/abilities/lua-modifiers/2.md",permalink:"/abilities/lua-modifiers/2",editUrl:"https://github.com/ModDota/moddota.github.io/edit/source/_articles/abilities/lua-modifiers/2.md",sidebar:"docs",previous:{title:"Extending Hero/NPC API with lua modifiers",permalink:"/abilities/lua-modifiers/1"},next:{title:"Transformations",permalink:"/abilities/lua-modifiers/3"}},l=[],s={rightToc:l};function c({components:e,...t}){return Object(i.b)("wrapper",Object(r.a)({},s,t,{components:e,mdxType:"MDXLayout"}),Object(i.b)("p",null,"When you script your targeted lua abilities you may have had issue of the protection against such spells not working. Linken Sphere and Lotus Orb.",Object(i.b)("br",{parentName:"p"}),"\n","To allow your cool new ability to be effected by these items you only need to add this line in your code:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),"if hTarget:TriggerSpellAbsorb( self ) then return end\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"hTarget")," in this example is assumed to be the target unit. The ",Object(i.b)("inlineCode",{parentName:"p"},"self")," is your ability. It is used by abilities like lotus orb to know what spell to send back. The ",Object(i.b)("inlineCode",{parentName:"p"},"hTarget:TriggerSpellAbsorb( self )")," returns true only if player has Linken Sphere or some custom item coded to have similar function.",Object(i.b)("br",{parentName:"p"}),"\n","In case of Lotus Orb the same line triggers Lotus Orb but always returns false.",Object(i.b)("br",{parentName:"p"}),"\n","Now to create your own Lotus/Linken like effects here are the two function declarations:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),'function my_modifier:DeclareFunctions()\n    local funcs = {\n        MODIFIER_PROPERTY_REFLECT_SPELL, --Lotus Orb trigger.\n        MODIFIER_PROPERTY_ABSORB_SPELL --Linken\'s Sphere trigger.\n    }\n    return funcs\nend\n\nfunction my_modifier:GetReflectSpell(keys)\n  print("you cast your spell on me!")\nend\n\nfunction my_modifier:GetAbsorbSpell(keys)\n  if something then\n      print("counter spell!")\n       return 1 --conditions were met, lets return 1 to block the spell.\n    end\n    return false --do nothing and let the spell through.\nend\n')),Object(i.b)("p",null,"With Linken sphere the code is pretty much checking the cooldown of the origin ability and if not on cooldown, play effect, return 1."),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),"function my_modifier:GetAbsorbSpell(keys)\n    local hAbility = self:GetAbility()\n    if hAbility:IsCooldownReady() then\n    --your cool effect here.\n    hAbility:StartCooldown(hAbility:GetCooldown(hAbility:GetLevel()))\n    return 1\n    end\n    return false\nend\n")),Object(i.b)("p",null,"Simple right? The Lotus Orb is bit more complex and even my version is not fully tested for bugs but it has been working perfectly so far."),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),"function my_modifier:GetReflectSpell(keys)\n    if self.stored ~= nil then\n        self.stored:RemoveSelf() --we make sure to remove previous spell.\n    end\n    local hCaster = self:GetParent()\n    local hAbility = hCaster:AddAbility(kv.ability:GetAbilityName())\n    hAbility:SetStolen(true) --just to be safe with some interactions.\n    hAbility:SetHidden(true) --hide the ability.\n    hAbility:SetLevel(kv.ability:GetLevel()) --same level of ability as the origin.\n    hCaster:SetCursorCastTarget(kv.ability:GetCaster()) --lets send this spell back.\n    hAbility:OnSpellStart() --cast the spell.\n    self.stored = hAbility --store the spell reference for future use.\nend\n")),Object(i.b)("p",null,"The reason we remove the stored spell at next trigger is to make sure there is no 'null' reference. For example if a modifier created by the spell tries to access the origin spell, if we were to remove it right after the cast, the game would give error message.",Object(i.b)("br",{parentName:"p"}),"\n","Some ideas how you could use all that you have learned here:",Object(i.b)("br",{parentName:"p"}),"\n","-Create combination of lotus and linken sphere. (block and reflect)",Object(i.b)("br",{parentName:"p"}),"\n","-Passive that reflects every third spell.",Object(i.b)("br",{parentName:"p"}),"\n","-Passive that blocks spell and gives you the mana used on it.",Object(i.b)("br",{parentName:"p"}),"\n","-Blink & disjoint projectiles when a spell is cast against you.  "),Object(i.b)("p",null,"Here is small piece of code to get you started with the blink:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-lua"}),'function my_modifier:Blink(hTarget, vPoint, nMaxBlink, nClamp)\n    local vOrigin = hTarget:GetAbsOrigin() --Our units\'s location\n    ProjectileManager:ProjectileDodge(hTarget)  --We disjoint disjointable incoming projectiles.\n    ParticleManager:CreateParticle("particles/items_fx/blink_dagger_start.vpcf", PATTACH_ABSORIGIN, hTarget) --Create particle effect at our caster.\n    hTarget:EmitSound("DOTA_Item.BlinkDagger.Activate") --Emit sound for the blink\n    local vDiff = vPoint - vOrigin --Difference between the points\n    if vDiff:Length2D() > nMaxBlink then  --Check caster is over reaching.\n        vPoint = vOrigin + (vPoint - vOrigin):Normalized() * nClamp -- Recalculation of the target point.\n    end\n    hTarget:SetAbsOrigin(vPoint) --We move the caster instantly to the location\n    FindClearSpaceForUnit(hTarget, vPoint, false) --This makes sure our caster does not get stuck\n    ParticleManager:CreateParticle("particles/items_fx/blink_dagger_end.vpcf", PATTACH_ABSORIGIN, hTarget) --Create particle effect at our caster.\nend\n')),Object(i.b)("p",null,"Next Topic: ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"lua-modifiers-3"}),"Transformations")))}c.isMDXComponent=!0},173:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d}));var r=n(0),i=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=i.a.createContext({}),u=function(e){var t=i.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return i.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},f=i.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),f=r,d=p["".concat(o,".").concat(f)]||p[f]||b[f]||a;return n?i.a.createElement(d,l(l({ref:t},c),{},{components:n})):i.a.createElement(d,l({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=f;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<a;c++)o[c]=n[c];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},174:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0),i=n.n(r);function a({id:e,aspectRatio:t=4/3}){return i.a.createElement("p",{style:{position:"relative",paddingBottom:1/t*100+"%"}},i.a.createElement("iframe",{src:"https://gfycat.com/ifr/"+e,scrolling:"no",frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}},175:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0),i=n.n(r);function a({id:e,playlistId:t,aspectRatio:n=16/9}){const r=void 0!==t?"https://www.youtube.com/embed/videoseries?list="+t:"https://www.youtube.com/embed/"+e;return i.a.createElement("p",{style:{position:"relative",paddingBottom:1/n*100+"%"}},i.a.createElement("iframe",{src:r,frameBorder:"0",allowFullScreen:!0,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0}}))}}}]);