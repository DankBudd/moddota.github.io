<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="search" type="application/opensearchdescription+xml" title="ModDota" href="/opensearch.xml"><title data-react-helmet="true">Extending Hero/NPC API with lua modifiers | ModDota</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Extending Hero/NPC API with lua modifiers | ModDota"><meta data-react-helmet="true" name="description" content="When creating cool new abilities or game mechanics you often run into issues with the lack of good API. While I admit the dota 2 has massive API, it seems to focus on few very odd things or mechanics not fully exposed by default game. (Runes, Spell Stealing, Illusions). To fix those issues you might want to expand it. Here is one method of doing so."><meta data-react-helmet="true" property="og:description" content="When creating cool new abilities or game mechanics you often run into issues with the lack of good API. While I admit the dota 2 has massive API, it seems to focus on few very odd things or mechanics not fully exposed by default game. (Runes, Spell Stealing, Illusions). To fix those issues you might want to expand it. Here is one method of doing so."><meta data-react-helmet="true" property="og:url" content="https://moddota.com/abilities/lua-modifiers/1"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://moddota.com/abilities/lua-modifiers/1"><link rel="stylesheet" href="/styles.32eaf7f3.css">
<link rel="stylesheet" href="/main.49954070.css">
<link rel="preload" href="/styles.bfce4c50.js" as="script">
<link rel="preload" href="/runtime~main.47887a06.js" as="script">
<link rel="preload" href="/main.928bda27.js" as="script">
<link rel="preload" href="/1.656d2891.js" as="script">
<link rel="preload" href="/2.3fc14b95.js" as="script">
<link rel="preload" href="/1be78505.69574c30.js" as="script">
<link rel="preload" href="/ec1ed54d.f1f64d91.js" as="script">
<link rel="preload" href="/3288f941.7af0e0db.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/images/logo-80x80.png"><strong class="navbar__title">ModDota</strong></a><a class="navbar__item navbar__link" href="/tutorials">Tutorials</a><a href="https://dota.tools/vscripts/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Lua API</a><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama/Javascript/API" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Panorama API</a></div><div class="navbar__items navbar__items--right"><a href="https://discord.gg/gRmZgvz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/images/logo-80x80.png"><strong class="navbar__title">ModDota</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tutorials">Tutorials</a></li><li class="menu__list-item"><a href="https://dota.tools/vscripts/" target="_blank" rel="noopener noreferrer" class="menu__link">Lua API</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama/Javascript/API" target="_blank" rel="noopener noreferrer" class="menu__link">Panorama API</a></li><li class="menu__list-item"><a href="https://discord.gg/gRmZgvz" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1jis"><div class="docSidebarContainer_1kjN"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/scripting-introduction">Scripting Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Abilities, items, modifiers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/ability-keyvalues">Ability KeyValues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/item-keyvalues">Item KeyValues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/the-importance-of-abilityspecial-values">The importance of AbilitySpecial values</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/passing-abilityspecial-values-into-lua">Passing AbilitySpecial values into Lua</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/abilityduration-tooltips">AbilityDuration tooltips</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/simple-custom-ability">Simple Custom Ability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/creating-innate-abilities">Creating innate (available from level 1) abilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/making-any-ability-use-charges">Making any ability use charges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/calling-spells-with-setcursor">Calling Spells with SetCursor</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Lua_Abilities_and_Modifiers" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Lua_Abilities_and_Modifiers" tabindex="0">Lua Abilities and Modifiers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/lua-item-tutorial">Lua Item Tutorial</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Lua Modifiers</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/abilities/lua-modifiers/1">Extending Hero/NPC API with lua modifiers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/lua-modifiers/2">Linken&#x27;s Sphere &amp; Lotus Orb</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/lua-modifiers/3">Transformations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/lua-modifiers/4">Enchanting Trees</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/reutilizing-built-in-modifiers">Reutilizing Built-In Modifiers</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Datadriven</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/datadriven-ability-events-modifiers">DataDriven Ability Events &amp; Modifiers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/all-about-the-target">All about the Target</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/channeling-animations">Channeling Animations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/invisibility-ability-example">Invisibility Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/illusion-ability-example">Illusion Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/rotate-ability-example">Rotate Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/point-channeling-aoe-ability-example">Point Channeling AoE Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/apply-hero-and-creep-modifier-durations">Apply Hero and Creep modifier durations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/physics-ability-example-exorcism">Physics Ability Example - Exorcism</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Units</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/unit-keyvalues">Unit KeyValues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/unit-producing-buildings">Unit producing buildings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/creating-units-with-a-duration">Creating units with a duration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/adding-a-very-simple-ai-to-units">Adding a Very Simple AI to Units</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/simple-neutral-ai">Writing a simple AI for neutrals</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/create-creature-attachwearable-blocks-directly-from-the-keyvalues">Create Creature AttachWearable blocks directly from the keyvalues</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Scripting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/custom-mana-system">Custom Mana System</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/item-restrictions-requirements">Item Restrictions &amp; Requirements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/item-drop-system">Item Drop System</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/making-a-rpg-like-looting-chest">Making a &quot;rpg-like&quot; looting chest</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/scripted-shop-spawning">Scripted Shop Spawning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/lava-damage">Lava damage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/using-dota-filters">Using the order filter and other filters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/particle-attachment">Particle Attachment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/precache-fixing-and-avoiding-issues">Precache, Fixing and avoiding issues</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Nettables" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Nettables" tabindex="-1">Custom NetTables</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Panorama UI</a><ul class="menu__list"><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama" tabindex="-1">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/inclusive-panorama-ui">Inclusive Panorama UI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/introduction-to-panorama-ui-with-typescript">Introduction to Panorama UI with TypeScript</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/keybindings">Keybindings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/dotascenepanel">DOTAScenePanel</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/button-examples">Button Examples</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Game_Setup" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Game_Setup" tabindex="-1">Custom Game Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/hiding-hud-with-sethudvisible">Hiding HUD with SetHUDVisible</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Assets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/asset-file-type-reference">Asset File Type Reference</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Maps</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/maps/hammer-tutorials">Hammer Tutorials</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/maps/making-skip-clip-blocks-out-of-models">Making skip/clip blocks out of models</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Models</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/importing-custom-models">Importing custom models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/mdl-to-vmdl-conversion">MDL to VMDL Conversion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/adding-hitbox-to-models-without-a-bone">Adding Hitbox to Models without a Bone</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/importing-models-and-using-material-editor">Importing models and using the material editor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/exporting-models-and-materials-textures">Exporting Models and Materials/Textures</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/custom-hero-models-materials-animations">Custom Hero models, materials and animations</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Particles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/particle-basics">Particle Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/chaos-wave-particle">Chaos Wave Particle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/falling-cherry-blossom-petal-for-spring-mood-particle">Falling cherry blossom petal for spring mood particle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/volcano-particle">Volcano Particle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/status-effects">Status Effects</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/custom-sounds">Custom Sounds</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/extracting-and-compiling-vtex-files">Extracting and Compiling VTEX files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/custom-minimap-icons">Custom Minimap Icons</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tools/useful-console-commands">Useful Console Commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tools/setting-up-your-addon-with-github">Setting Up Your Addon With GitHub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tools/combining-kv-files-using-base">Combining KV files using #base</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/contribute">Contribute</a></li></ul></div></div></div><main class="docMainContainer_3j_A"><div class="container padding-vert--lg docItemWrapper_1Hme"><div class="row"><div class="col docItemCol_2AGf"><div class="docItemContainer_1tAC"><article><div style="margin-top:-10px;margin-bottom:10px"><div class="row"><div class="col"><a href="https://github.com/ModDota/moddota.github.io/edit/source/_articles/abilities/lua-modifiers/1.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Created on <time datetime="2016-08-21T00:00:00.000Z" class="docLastUpdatedAt_1gIo">8/21/2016</time> by <strong><a href="https://steamcommunity.com/profiles/76561197975484185">DrTeaSpoon</a></strong></small></em></div></div></div><header><h1 class="docTitle_cWlf">Extending Hero/NPC API with lua modifiers</h1></header><div class="markdown"><p>When creating cool new abilities or game mechanics you often run into issues with the lack of good API. While I admit the dota 2 has massive API, it seems to focus on few very odd things or mechanics not fully exposed by default game. (Runes, Spell Stealing, Illusions). To fix those issues you might want to expand it. Here is one method of doing so.<br>
If you are using BMD&#x27;s Barebones then you already have neatly exposed function <code>GameMode:OnHeroInGame(hero)</code> in your <code>internal/gamemode.lua</code> file. Otherwise you will want to listen to NPC spawning when initializing your game mode:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function Activate()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  LinkLuaModifier( &quot;heroes_base_mod&quot;, &quot;lua_modifiers/hero_base_mod.lua&quot;, LUA_MODIFIER_MOTION_NONE )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  ListenToGameEvent(&#x27;npc_spawned&#x27;, Dynamic_Wrap(CModDotaTutorialsGameMode, &#x27;OnNPC_Spawn&#x27;), CModDotaTutorialsGameMode)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function CModDotaTutorialsGameMode:OnNPC_Spawn(keys)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  local npc = EntIndexToHScript(keys.entindex)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  if npc:IsRealHero() and npc.bInit == nil then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    npc.bInit = true</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        OnHeroFirst_Spawn(npc)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function OnHeroFirst_Spawn(hero)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  hero:AddNewModifier( hero, nil, &quot;heroes_base_mod&quot;, {} )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>NOTE: Keep in mind your gamemode&#x27;s function name. I used <code>CModDotaTutorialsGameMode</code>. You should probably have something else. Now lets get back to topic. As you noticed we used <code>LinkLuaModifier</code>. We should create file it points to in your vscripts folder <code>&quot;lua_modifiers/hero_base_mod.lua&quot;</code><br>
For this example we are tracking what is the last spell player has cast. This could be used potentially as the building blocks for recreating Rubick&#x27;s spell steal.<br>
If you are unfamiliar with lua modifiers here is the only essential part of your modifier:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">if heroes_base_mod == nil then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    heroes_base_mod = class({})</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Next we want to make sure the modifier is not disabled at any point:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function heroes_base_mod:GetAttributes()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return MODIFIER_ATTRIBUTE_PERMANENT + MODIFIER_ATTRIBUTE_IGNORE_INVULNERABLE</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Here is the meat of our function&#x27;s purpose. Track when this hero casts a spell.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function heroes_base_mod:DeclareFunctions()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local funcs = {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        MODIFIER_EVENT_ON_ABILITY_EXECUTED</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return funcs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function heroes_base_mod:OnAbilityExecuted(params)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if IsServer() then --Make sure we are doing this only server side.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if params.unit == self:GetParent() then --we only want the spells cast by this unit.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if not params.ability:IsItem() then --we don&#x27;t want to track items.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self.lastability = params.ability --record the ability handle.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now we get to the magic:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function heroes_base_mod:OnCreated(kv)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hMod = self --we can only reference to &quot;self&quot; in our own function we pass this modifier to function we create for the unit.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hParent = self:GetParent() --the unit.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if hParent.GetLastSpell == nil then --if for some odd reason there is already such function</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        function hParent:GetLastSpell() ---we create new function for the unit.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if hMod.lastability ~= nil then --if unit has cast any spells</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return hMod.lastability --return the last ability.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return nil --in case there is nothing to return. this is sort of redundant.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Because we assume every hero having this modifier its kinda useless to show it on the screen.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function heroes_base_mod:IsHidden()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return true</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now that we have our modifier done. We want some way of testing it. I decided to go with simple console command. Add following to your game init function.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">-- this is in function Activate()</span></div><div class="token-line" style="color:#393A34"><span class="token plain"> Convars:RegisterCommand( &quot;mod_test_spells&quot;, Dynamic_Wrap(CModDotaTutorialsGameMode, &#x27;PrintLastSpells&#x27;), &quot;Print last spell for every hero&quot;, FCVAR_CHEAT )</span></div></div></div></div></div><p>Now the actual console command&#x27;s function:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function CModDotaTutorialsGameMode:PrintLastSpells()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  print( &#x27;** Last Spell **&#x27; )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local tList = HeroList:GetAllHeroes()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    for k,v in pairs(tList) do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local s = v:GetLastSpell()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if s == nil then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            print( v:GetName() .. &#x27; has cast no spells yet.&#x27;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            print( v:GetName() .. &#x27; last cast &#x27; .. v:GetLastSpell():GetAbilityName())</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  print( &#x27;****************&#x27; )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now you should be able to use console command <code>mod_test_spells</code> to print out the last spell every hero has used.<br>
Next topic: <a href="/abilities/lua-modifiers/lua-modifiers-2">Linken Sphere &amp; Lotus Orb.</a></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/abilities/lua-item-tutorial"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Lua Item Tutorial</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/abilities/lua-modifiers/2"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Linken&#x27;s Sphere &amp; Lotus Orb »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_tVyB"></div></div></div></div></main></div></div></div>
<script src="/styles.bfce4c50.js"></script>
<script src="/runtime~main.47887a06.js"></script>
<script src="/main.928bda27.js"></script>
<script src="/1.656d2891.js"></script>
<script src="/2.3fc14b95.js"></script>
<script src="/1be78505.69574c30.js"></script>
<script src="/ec1ed54d.f1f64d91.js"></script>
<script src="/3288f941.7af0e0db.js"></script>
</body>
</html>